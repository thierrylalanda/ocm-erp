import{c as b}from"./chunk-HOOCBFFS.js";import{C as v}from"./chunk-E22WOTPK.js";import{I as c,Pa as h,ca as p,g as s,gd as L,ha as d,la as o,nb as l,r as u,xb as f}from"./chunk-RKWTZGMB.js";var n=class r{constructor(t,a){this.http=t;this.platformId=a;this.initializeLanguage()}DEFAULT_LANGUAGE="fr";STORAGE_KEY="app_language";TRANSLATIONS_PATH="assets/i18n";translations={};currentLanguage$=new s(this.DEFAULT_LANGUAGE);translationsLoaded$=new s(!1);translationsLoaded=!1;initializeLanguage(){let t=this.DEFAULT_LANGUAGE;if(this.isBrowser()){let a=localStorage.getItem(this.STORAGE_KEY);if(a&&this.isValidLanguage(a))t=a;else{let i=navigator.language.split("-")[0];this.isValidLanguage(i)&&(t=i)}}this.setLanguage(t,!1)}isBrowser(){return v(this.platformId)}isValidLanguage(t){return["fr","en"].includes(t)}loadTranslations(t){let a=`${this.TRANSLATIONS_PATH}/${t}.json`;return this.http.get(a).pipe(p(i=>{this.translations=i,this.translationsLoaded=!0,this.translationsLoaded$.next(!0)}),c(i=>(console.error(`Failed to load translations for ${t}:`,i),u({}))))}setLanguage(t,a=!0){this.isValidLanguage(t)||(console.warn(`Invalid language code: ${t}. Using default.`),t=this.DEFAULT_LANGUAGE),(this.currentLanguage$.value!==t||!this.translationsLoaded)&&this.loadTranslations(t).subscribe(()=>{this.currentLanguage$.next(t),a&&this.isBrowser()&&localStorage.setItem(this.STORAGE_KEY,t)})}getCurrentLanguage(){return this.currentLanguage$.value}get languageChanges(){return this.currentLanguage$.asObservable()}get translationsLoadedChanges(){return this.translationsLoaded$.asObservable()}translate(t,a){if(!this.translationsLoaded)return t;let i=t.split("."),e=this.translations;for(let g of i)if(e&&typeof e=="object"&&g in e)e=e[g];else return t;return typeof e!="string"?t:a?this.replaceParams(e,a):e}replaceParams(t,a){return t.replace(/\{(\w+)\}/g,(i,e)=>a[e]!==void 0?a[e]:i)}getAvailableLanguages(){return[{code:"fr",name:"Fran\xE7ais",flag:"\u{1F1EB}\u{1F1F7}"},{code:"en",name:"English",flag:"\u{1F1EC}\u{1F1E7}"}]}isLoaded(){return this.translationsLoaded}static \u0275fac=function(a){return new(a||r)(o(b),o(h))};static \u0275prov=d({token:r,factory:r.\u0275fac,providedIn:"root"})};var m=class r{constructor(t,a){this.translationService=t;this.changeDetectorRef=a;this.languageChangeSubscription=this.translationService.languageChanges.subscribe(()=>{this.updateTranslation(),this.changeDetectorRef.markForCheck()}),this.translationsLoadedSubscription=this.translationService.translationsLoadedChanges.subscribe(()=>{this.updateTranslation(),this.changeDetectorRef.markForCheck()})}lastKey="";lastParams=null;lastValue="";languageChangeSubscription;translationsLoadedSubscription;transform(t,a){return(t!==this.lastKey||JSON.stringify(a)!==JSON.stringify(this.lastParams))&&(this.lastKey=t,this.lastParams=a,this.updateTranslation()),this.lastValue}updateTranslation(){this.lastValue=this.translationService.translate(this.lastKey,this.lastParams)}ngOnDestroy(){this.languageChangeSubscription&&this.languageChangeSubscription.unsubscribe(),this.translationsLoadedSubscription&&this.translationsLoadedSubscription.unsubscribe()}static \u0275fac=function(a){return new(a||r)(l(n,16),l(L,16))};static \u0275pipe=f({name:"translate",type:r,pure:!1})};export{n as a,m as b};
