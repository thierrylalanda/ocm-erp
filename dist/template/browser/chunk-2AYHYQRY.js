import{a as z}from"./chunk-INBIJHSE.js";import{a as j,d as $,e as B,f as H}from"./chunk-7V5A6UDA.js";import"./chunk-56PAQBI2.js";import"./chunk-J3F46MY4.js";import"./chunk-YZ2ZCIPF.js";import"./chunk-BJHRZJ5G.js";import"./chunk-5SKCDVUK.js";import"./chunk-3P6NPTNP.js";import"./chunk-4XP2POTR.js";import"./chunk-ETTDFRY5.js";import"./chunk-MMYELGJW.js";import"./chunk-26FPSVGJ.js";import"./chunk-IEXRXU6D.js";import"./chunk-CSQUQHMV.js";import"./chunk-IBG7KWSR.js";import"./chunk-FIUXCDVZ.js";import"./chunk-3WBD4RP4.js";import"./chunk-IPRI2H5J.js";import{a as V}from"./chunk-H5RQM42I.js";import{f as J}from"./chunk-BEOLW65W.js";import"./chunk-VXIQ3B2H.js";import{C as R,d as U,f as c,h as q,i as N,j as D,n as L,q as k,r as G,z as O}from"./chunk-OZCTR5Q5.js";import{b as M}from"./chunk-6P5VJYPL.js";import"./chunk-VLYMLFWW.js";import"./chunk-5IGNUQZL.js";import"./chunk-G64D4X4E.js";import{c as T}from"./chunk-HOOCBFFS.js";import{k as y,l as P,y as A}from"./chunk-E22WOTPK.js";import{$b as F,Rb as a,Sb as n,Tb as i,Ub as l,fc as h,ha as C,hb as o,hc as f,la as E,nb as w,ra as v,sa as g,tc as u,ub as I,wc as s,xc as b,yc as _,zb as d,zc as x}from"./chunk-RKWTZGMB.js";import"./chunk-EQDQRRRY.js";var S=class r{constructor(t,e){this.http=t;this.authService=e}baseUrl=V.api+"hierarchie/utilisateurs";getUser(t){return this.http.get(`${this.baseUrl}/${t}`)}getCurrentUser(){let t=this.authService.user;if(!t||!t.id)throw new Error("User not authenticated or user ID not found");return this.getUser(t.id)}updateUser(t,e){return this.http.put(`${this.baseUrl}/${t}`,e)}updateCurrentUser(t){let e=this.authService.user;if(!e||!e.id)throw new Error("User not authenticated or user ID not found");return this.updateUser(e.id,t)}updatePassword(t,e,m){return this.http.post(`${this.baseUrl}/${t}/change-password`,{currentPassword:e,newPassword:m})}updateCurrentUserPassword(t,e){let m=this.authService.user;if(!m||!m.id)throw new Error("User not authenticated or user ID not found");return this.updatePassword(m.id,t,e)}static \u0275fac=function(e){return new(e||r)(E(T),E(M))};static \u0275prov=C({token:r,factory:r.\u0275fac,providedIn:"root"})};function X(r,t){r&1&&(n(0,"div",7)(1,"div",8)(2,"span",9),s(3,"Loading..."),i()(),n(4,"p",10),s(5,"Chargement des donn\xE9es utilisateur..."),i()())}function Y(r,t){if(r&1&&(n(0,"div",11),s(1),i()),r&2){let e=f();o(),_(" ",e.errorMessage," ")}}function Z(r,t){if(r&1&&(n(0,"div",12),s(1),i()),r&2){let e=f();o(),_(" ",e.successMessage," ")}}function ee(r,t){r&1&&(n(0,"div",57),s(1," Le nom et pr\xE9nom sont requis. "),i())}function te(r,t){r&1&&(n(0,"div",57),s(1," L'email est requis. "),i())}function ie(r,t){r&1&&(n(0,"div",57),s(1," Veuillez entrer un email valide. "),i())}function ne(r,t){r&1&&(n(0,"div",57),s(1," Le t\xE9l\xE9phone est requis. "),i())}function re(r,t){if(r&1&&(n(0,"mat-option",58),s(1),i()),r&2){let e=t.$implicit;a("value",e),o(),b(e)}}function se(r,t){r&1&&(n(0,"div",57),s(1," Le statut est requis. "),i())}function oe(r,t){if(r&1&&(n(0,"mat-option",58),s(1),i()),r&2){let e=t.$implicit;a("value",e),o(),b(e)}}function ae(r,t){r&1&&(n(0,"div",57),s(1," La langue est requise. "),i())}function me(r,t){r&1&&(n(0,"div",57),s(1," Le mot de passe doit contenir au moins 6 caract\xE8res. "),i())}function le(r,t){r&1&&(n(0,"div",57),s(1," L'adresse est requise. "),i())}function de(r,t){if(r&1&&(n(0,"div",11),s(1),i()),r&2){let e=f(2);o(),_(" ",e.passwordErrorMessage," ")}}function ce(r,t){if(r&1&&(n(0,"div",12),s(1),i()),r&2){let e=f(2);o(),_(" ",e.passwordSuccessMessage," ")}}function pe(r,t){r&1&&(n(0,"div",57),s(1," Le mot de passe actuel est requis. "),i())}function ue(r,t){r&1&&(n(0,"div",57),s(1," Au moins 6 caract\xE8res. "),i())}function fe(r,t){r&1&&(n(0,"div",57),s(1," Le nouveau mot de passe est requis. "),i())}function ve(r,t){r&1&&(n(0,"div",57),s(1," Au moins 6 caract\xE8res. "),i())}function ge(r,t){r&1&&(n(0,"div",57),s(1," La confirmation est requise. "),i())}function he(r,t){r&1&&(n(0,"div",57),s(1," Au moins 6 caract\xE8res. "),i())}function _e(r,t){r&1&&(n(0,"div",57),s(1," Les mots de passe ne correspondent pas. "),i())}function xe(r,t){r&1&&(n(0,"span"),s(1,"Changer le mot de passe"),i())}function Se(r,t){r&1&&(n(0,"span"),l(1,"span",59),s(2," Changement... "),i())}function Ee(r,t){r&1&&(n(0,"span"),s(1,"Enregistrer les modifications"),i())}function we(r,t){r&1&&(n(0,"span"),l(1,"span",59),s(2," Enregistrement... "),i())}function be(r,t){if(r&1){let e=F();n(0,"form",13),h("ngSubmit",function(){v(e);let p=f();return g(p.onSubmit())}),n(1,"div",14)(2,"div",15)(3,"span",16),l(4,"i",17),i(),n(5,"h6",18),s(6,"Informations g\xE9n\xE9rales"),i()(),n(7,"div",19)(8,"div",20)(9,"div",0)(10,"label",21),s(11,"Nom & Pr\xE9nom "),n(12,"span",22),s(13,"*"),i()(),l(14,"input",23),d(15,ee,2,0,"div",24),i()(),n(16,"div",20)(17,"div",0)(18,"label",21),s(19,"Email "),n(20,"span",22),s(21,"*"),i()(),l(22,"input",25),d(23,te,2,0,"div",24)(24,ie,2,0,"div",24),i()(),n(25,"div",20)(26,"div",0)(27,"label",21),s(28,"T\xE9l\xE9phone "),n(29,"span",22),s(30,"*"),i()(),l(31,"input",26),d(32,ne,2,0,"div",24),i()(),n(33,"div",20)(34,"div",0)(35,"label",21),s(36,"Statut"),i(),n(37,"mat-select",27)(38,"mat-option",28),s(39,"S\xE9lectionner"),i(),d(40,re,2,2,"mat-option",29),i(),d(41,se,2,0,"div",24),i()(),n(42,"div",20)(43,"div",0)(44,"label",21),s(45,"Langue"),i(),n(46,"mat-select",30)(47,"mat-option",28),s(48,"S\xE9lectionner"),i(),d(49,oe,2,2,"mat-option",29),i(),d(50,ae,2,0,"div",24),i()(),n(51,"div",20)(52,"div",0)(53,"label",21),s(54,"Mot de passe"),i(),l(55,"input",31),d(56,me,2,0,"div",24),n(57,"small",32),s(58,"Laissez vide pour ne pas modifier"),i()()()()(),n(59,"div",33)(60,"div",15)(61,"span",16),l(62,"i",17),i(),n(63,"h6",18),s(64,"Informations d'adresse"),i()(),n(65,"div",19)(66,"div",34)(67,"div",0)(68,"label",21),s(69,"Adresse "),n(70,"span",22),s(71,"*"),i()(),l(72,"input",35),d(73,le,2,0,"div",24),i()(),n(74,"div",36)(75,"div",0)(76,"label",21),s(77,"Soci\xE9t\xE9"),i(),l(78,"input",37),n(79,"small",32),s(80),i()()(),n(81,"div",36)(82,"div",0)(83,"label",21),s(84,"Site"),i(),l(85,"input",38),n(86,"small",32),s(87),i()()(),n(88,"div",36)(89,"div",0)(90,"label",21),s(91,"D\xE9partement"),i(),l(92,"input",39),n(93,"small",32),s(94),i()()(),n(95,"div",36)(96,"div",0)(97,"label",21),s(98,"Photo"),i(),l(99,"input",40),n(100,"small",32),s(101,"URL de la photo de profil"),i()()(),n(102,"div",41)(103,"div",0)(104,"label",21),s(105,"Signature"),i(),l(106,"input",42),n(107,"small",32),s(108,"URL de la signature"),i()()()()(),n(109,"div",43)(110,"div",15)(111,"span",16),l(112,"i",44),i(),n(113,"h6",18),s(114,"Changement de mot de passe"),i()(),d(115,de,2,1,"div",4)(116,ce,2,1,"div",5),n(117,"div",45)(118,"div",19)(119,"div",46)(120,"div",0)(121,"label",21),s(122,"Mot de passe actuel "),n(123,"span",22),s(124,"*"),i()(),l(125,"input",47),d(126,pe,2,0,"div",24)(127,ue,2,0,"div",24),i()(),n(128,"div",46)(129,"div",0)(130,"label",21),s(131,"Nouveau mot de passe "),n(132,"span",22),s(133,"*"),i()(),l(134,"input",48),d(135,fe,2,0,"div",24)(136,ve,2,0,"div",24),i()(),n(137,"div",46)(138,"div",0)(139,"label",21),s(140,"Confirmer le mot de passe "),n(141,"span",22),s(142,"*"),i()(),l(143,"input",49),d(144,ge,2,0,"div",24)(145,he,2,0,"div",24)(146,_e,2,0,"div",24),i()()(),n(147,"div",50)(148,"button",51),h("click",function(){v(e);let p=f();return g(p.onCancelPassword())}),s(149,"Annuler"),i(),n(150,"button",52),h("click",function(){v(e);let p=f();return g(p.onChangePassword())}),d(151,xe,2,0,"span",53)(152,Se,3,0,"span",53),i()()()(),n(153,"div",54)(154,"button",55),h("click",function(){v(e);let p=f();return g(p.onCancel())}),s(155,"Annuler"),i(),n(156,"button",56),d(157,Ee,2,0,"span",53)(158,we,3,0,"span",53),i()()()}if(r&2){let e=f();a("formGroup",e.userForm),o(14),u("is-invalid",e.isFieldInvalid("nomPrenom")),o(),a("ngIf",e.hasError("nomPrenom","required")),o(7),u("is-invalid",e.isFieldInvalid("email")),o(),a("ngIf",e.hasError("email","required")),o(),a("ngIf",e.hasError("email","email")),o(7),u("is-invalid",e.isFieldInvalid("telephone")),o(),a("ngIf",e.hasError("telephone","required")),o(5),u("is-invalid",e.isFieldInvalid("statut")),o(3),a("ngForOf",e.statutOptions),o(),a("ngIf",e.hasError("statut","required")),o(5),u("is-invalid",e.isFieldInvalid("langue")),o(3),a("ngForOf",e.langueOptions),o(),a("ngIf",e.hasError("langue","required")),o(5),u("is-invalid",e.hasError("pwdText","minlength")),o(),a("ngIf",e.hasError("pwdText","minlength")),o(16),u("is-invalid",e.isFieldInvalid("adresse")),o(),a("ngIf",e.hasError("adresse","required")),o(7),x("ID: ",e.user==null?null:e.user.societeId," - ",e.user==null?null:e.user.societeNom),o(7),x("ID: ",e.user==null?null:e.user.siteId," - ",e.user==null?null:e.user.siteNom),o(7),x("ID: ",e.user==null?null:e.user.departementId," - ",e.user==null?null:e.user.departementNom),o(21),a("ngIf",e.passwordErrorMessage),o(),a("ngIf",e.passwordSuccessMessage),o(),a("formGroup",e.passwordForm),o(8),u("is-invalid",e.isFieldInvalid("currentPassword",e.passwordForm)),o(),a("ngIf",e.hasError("currentPassword","required",e.passwordForm)),o(),a("ngIf",e.hasError("currentPassword","minlength",e.passwordForm)),o(7),u("is-invalid",e.isFieldInvalid("newPassword",e.passwordForm)),o(),a("ngIf",e.hasError("newPassword","required",e.passwordForm)),o(),a("ngIf",e.hasError("newPassword","minlength",e.passwordForm)),o(7),u("is-invalid",e.isFieldInvalid("confirmPassword",e.passwordForm)||e.getPasswordMismatchError()),o(),a("ngIf",e.hasError("confirmPassword","required",e.passwordForm)),o(),a("ngIf",e.hasError("confirmPassword","minlength",e.passwordForm)),o(),a("ngIf",e.getPasswordMismatchError()),o(2),a("disabled",e.isChangingPassword),o(2),a("disabled",e.passwordForm.invalid||e.isChangingPassword),o(),a("ngIf",!e.isChangingPassword),o(),a("ngIf",e.isChangingPassword),o(2),a("disabled",e.isSaving),o(2),a("disabled",e.userForm.invalid||e.isSaving||!e.userForm.dirty),o(),a("ngIf",!e.isSaving),o(),a("ngIf",e.isSaving)}}var K=class r{constructor(t,e){this.fb=t;this.userService=e;this.userForm=this.createUserForm(),this.passwordForm=this.createPasswordForm()}userForm;passwordForm;isLoading=!1;isSaving=!1;isChangingPassword=!1;errorMessage="";successMessage="";passwordSuccessMessage="";passwordErrorMessage="";user=null;statutOptions=["ACTIF","INACTIF"];langueOptions=["fr","en","es","de"];ngOnInit(){this.loadUser()}createUserForm(){return this.fb.group({nomPrenom:["",[c.required]],telephone:["",[c.required]],adresse:["",[c.required]],email:["",[c.required,c.email]],pwdText:["",[c.minLength(6)]],societeId:[{value:"",disabled:!0}],siteId:[{value:"",disabled:!0}],departementId:[{value:"",disabled:!0}],statut:["ACTIF",[c.required]],photo:[""],signature:[""],langue:["fr",[c.required]]})}createPasswordForm(){return this.fb.group({currentPassword:["",[c.required,c.minLength(6)]],newPassword:["",[c.required,c.minLength(6)]],confirmPassword:["",[c.required,c.minLength(6)]]},{validator:this.passwordMatchValidator})}passwordMatchValidator(t){let e=t.get("newPassword")?.value,m=t.get("confirmPassword")?.value;return e===m?null:{mismatch:!0}}loadUser(){this.isLoading=!0,this.errorMessage="",this.userService.getCurrentUser().subscribe({next:t=>{this.user=t,this.userForm.patchValue({nomPrenom:t.nomPrenom,telephone:t.telephone,adresse:t.adresse,email:t.email,pwdText:"",societeId:t.societeId,siteId:t.siteId,departementId:t.departementId,statut:t.statut,photo:t.photo,signature:t.signature,langue:t.langue||"fr"}),this.isLoading=!1},error:t=>{this.errorMessage="Erreur lors du chargement des donn\xE9es utilisateur: "+(t.error?.message||t.message),this.isLoading=!1,console.error("Error loading user:",t)}})}onSubmit(){if(this.userForm.invalid){this.markFormGroupTouched(this.userForm);return}this.isSaving=!0,this.errorMessage="",this.successMessage="";let t=this.userForm.value;t.societeId=this.user?.societeId||0,t.siteId=this.user?.siteId||0,t.departementId=this.user?.departementId||0,this.userService.updateCurrentUser(t).subscribe({next:e=>{this.user=e,this.successMessage="Les modifications ont \xE9t\xE9 enregistr\xE9es avec succ\xE8s.",this.isSaving=!1,this.userForm.markAsPristine()},error:e=>{this.errorMessage="Erreur lors de la mise \xE0 jour: "+(e.error?.message||e.message),this.isSaving=!1,console.error("Error updating user:",e)}})}onChangePassword(){if(this.passwordForm.invalid){this.markFormGroupTouched(this.passwordForm);return}this.isChangingPassword=!0,this.passwordErrorMessage="",this.passwordSuccessMessage="";let{currentPassword:t,newPassword:e}=this.passwordForm.value;this.userService.updateCurrentUserPassword(t,e).subscribe({next:()=>{this.passwordSuccessMessage="Mot de passe modifi\xE9 avec succ\xE8s.",this.isChangingPassword=!1,this.passwordForm.reset()},error:m=>{this.passwordErrorMessage="Erreur lors du changement de mot de passe: "+(m.error?.message||m.message),this.isChangingPassword=!1,console.error("Error changing password:",m)}})}onCancel(){this.user&&(this.userForm.patchValue({nomPrenom:this.user.nomPrenom,telephone:this.user.telephone,adresse:this.user.adresse,email:this.user.email,pwdText:"",statut:this.user.statut,photo:this.user.photo,signature:this.user.signature,langue:this.user.langue||"fr"}),this.userForm.markAsPristine()),this.errorMessage="",this.successMessage=""}onCancelPassword(){this.passwordForm.reset(),this.passwordErrorMessage="",this.passwordSuccessMessage=""}markFormGroupTouched(t){Object.values(t.controls).forEach(e=>{e.markAsTouched(),e instanceof D&&this.markFormGroupTouched(e)})}hasError(t,e,m=this.userForm){let p=m.get(t);return p?p.hasError(e)&&p.touched:!1}isFieldInvalid(t,e=this.userForm){let m=e.get(t);return m?m.invalid&&m.touched:!1}getPasswordMismatchError(){let t=this.passwordForm.get("newPassword")?.touched||!1,e=this.passwordForm.get("confirmPassword")?.touched||!1;return this.passwordForm.hasError("mismatch")&&t&&e}static \u0275fac=function(e){return new(e||r)(w(O),w(S))};static \u0275cmp=I({type:r,selectors:[["app-account-settings"]],decls:8,vars:4,consts:[[1,"mb-3"],[1,"pb-3","border-bottom","mb-3"],[1,"mb-0"],["class","text-center py-5",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","alert alert-success",4,"ngIf"],[3,"formGroup","ngSubmit",4,"ngIf"],[1,"text-center","py-5"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"alert","alert-danger"],[1,"alert","alert-success"],[3,"ngSubmit","formGroup"],[1,"border-bottom","mb-3","pb-2"],[1,"d-flex","align-items-center","mb-3"],[1,"bg-dark","avatar","avatar-sm","me-2","flex-shrink-0"],[1,"isax","isax-info-circle","fs-14"],[1,"fs-16","fw-semibold","mb-0"],[1,"row","gx-3"],[1,"col-lg-4","col-md-6"],[1,"form-label"],[1,"text-danger"],["type","text","formControlName","nomPrenom",1,"form-control"],["class","invalid-feedback d-block",4,"ngIf"],["type","email","formControlName","email",1,"form-control"],["type","text","formControlName","telephone",1,"form-control"],["formControlName","statut",1,"custom-mat-select","select"],["value",""],[3,"value",4,"ngFor","ngForOf"],["formControlName","langue",1,"custom-mat-select","select"],["type","password","formControlName","pwdText",1,"form-control"],[1,"text-muted"],[1,"border-bottom","mb-3"],[1,"col-lg-12"],["type","text","formControlName","adresse",1,"form-control"],[1,"col-md-6"],["type","text","formControlName","societeId","readonly","",1,"form-control"],["type","text","formControlName","siteId","readonly","",1,"form-control"],["type","text","formControlName","departementId","readonly","",1,"form-control"],["type","text","formControlName","photo",1,"form-control"],[1,"col-md-12"],["type","text","formControlName","signature",1,"form-control"],[1,"border-bottom","mb-3","pb-3"],[1,"isax","isax-lock","fs-14"],[3,"formGroup"],[1,"col-md-4"],["type","password","formControlName","currentPassword",1,"form-control"],["type","password","formControlName","newPassword",1,"form-control"],["type","password","formControlName","confirmPassword",1,"form-control"],[1,"d-flex","align-items-center","justify-content-between","mt-3"],["type","button",1,"btn","btn-outline-secondary",3,"click","disabled"],["type","button",1,"btn","btn-primary",3,"click","disabled"],[4,"ngIf"],[1,"d-flex","align-items-center","justify-content-between","mt-4"],["type","button",1,"btn","btn-outline-white",3,"click","disabled"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"invalid-feedback","d-block"],[3,"value"],["role","status","aria-hidden","true",1,"spinner-border","spinner-border-sm","me-1"]],template:function(e,m){e&1&&(n(0,"div",0)(1,"div",1)(2,"h6",2),s(3,"Account Settings"),i()(),d(4,X,6,0,"div",3)(5,Y,2,1,"div",4)(6,Z,2,1,"div",5)(7,be,159,55,"form",6),i()),e&2&&(o(4),a("ngIf",m.isLoading),o(),a("ngIf",m.errorMessage&&!m.isLoading),o(),a("ngIf",m.successMessage),o(),a("ngIf",!m.isLoading))},dependencies:[A,y,P,H,B,j,z,$,R,L,U,q,N,k,G,J],encapsulation:2})};export{K as AccountSettingsComponent};
