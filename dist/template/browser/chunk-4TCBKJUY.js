import{b,c as P,d as T}from"./chunk-EC24VSHY.js";import{a as C}from"./chunk-Z4FQMWZ2.js";import{c as A}from"./chunk-3WBD4RP4.js";import{a as U}from"./chunk-JAHFL35X.js";import{a as $}from"./chunk-H5RQM42I.js";import{b as I}from"./chunk-CPHVHMG6.js";import{a,c as O}from"./chunk-DXRJN4NQ.js";import{Db as y,J as s,ia as p,ma as m,mb as D,na as o,r as d,s as S,w as E,wa as R,xa as _}from"./chunk-ODQYRIBQ.js";var j=class n{constructor(i,e){this.http=i;this.authService=e}apiUrl=`${$.api}hierarchie/sites`;getSites(i){let e=new a;return i.page!==void 0&&(e=e.set("page",i.page.toString())),i.size!==void 0&&(e=e.set("size",i.size.toString())),i.societeId!==void 0&&(e=e.set("societeId",i.societeId.toString())),i.type&&(e=e.set("type",i.type)),i.actif!==void 0&&(e=e.set("actif",i.actif.toString())),i.ville&&(e=e.set("ville",i.ville)),i.pays&&(e=e.set("pays",i.pays)),this.http.get(this.apiUrl,{params:e}).pipe(s(t=>this.handleError(t,"Erreur lors de la r\xE9cup\xE9ration des sites")))}getSite(i){return this.http.get(`${this.apiUrl}/${i}`).pipe(s(e=>this.handleError(e,"Site non trouv\xE9")))}createSite(i){return this.http.post(this.apiUrl,i).pipe(s(e=>this.handleError(e,"Erreur lors de la cr\xE9ation du site")))}updateSite(i,e){return this.http.put(`${this.apiUrl}/${i}`,e).pipe(s(t=>this.handleError(t,"Erreur lors de la mise \xE0 jour du site")))}deleteSite(i){return this.http.delete(`${this.apiUrl}/${i}`).pipe(s(e=>this.handleError(e,"Erreur lors de la suppression du site")))}toggleSiteStatus(i,e){return this.http.patch(`${this.apiUrl}/${i}/status`,{actif:e}).pipe(s(t=>this.handleError(t,"Erreur lors du changement de statut")))}getCurrentUserSocieteId(){return this.authService.user?.societeId||null}handleError(i,e){let t=e;if(i.error instanceof ErrorEvent)t=`Erreur: ${i.error.message}`;else switch(i.status){case 400:t="Donn\xE9es invalides. V\xE9rifiez les champs du formulaire.",i.error?.message&&(t+=` ${i.error.message}`);break;case 401:t="Non autoris\xE9. Veuillez vous reconnecter.";break;case 403:t="Acc\xE8s interdit. Vous n'avez pas les permissions n\xE9cessaires.";break;case 404:t="Site non trouv\xE9.";break;case 409:t="Un site avec ce code existe d\xE9j\xE0 pour cette soci\xE9t\xE9.";break;case 500:t="Erreur serveur. Veuillez r\xE9essayer plus tard.";break;case 503:t="Service temporairement indisponible. Veuillez r\xE9essayer.";break;default:t=`${e} (Code: ${i.status})`,i.error?.message&&(t+=` - ${i.error.message}`)}return console.error("Site Service Error:",{status:i.status,message:t,error:i.error}),S(()=>new Error(t))}checkCodeAvailability(i,e,t){let r=new a().set("code",i).set("societeId",e.toString());return t&&(r=r.set("excludeId",t.toString())),this.http.get(`${this.apiUrl}/check-code`,{params:r}).pipe(E(c=>c.available),s(()=>d(!0)))}exportSitesToCsv(i){let e=new a;return i.societeId!==void 0&&(e=e.set("societeId",i.societeId.toString())),i.type&&(e=e.set("type",i.type)),i.actif!==void 0&&(e=e.set("actif",i.actif.toString())),this.http.get(`${this.apiUrl}/export/csv`,{params:e,responseType:"blob"}).pipe(s(t=>this.handleError(t,"Erreur lors de l'export")))}getSiteStatistics(i){let e=new a().set("societeId",i.toString());return this.http.get(`${this.apiUrl}/statistics`,{params:e}).pipe(s(()=>d({total:0,actifs:0,inactifs:0,parType:{},parVille:{},parPays:{}})))}static \u0275fac=function(e){return new(e||n)(m(O),m(I))};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var x={capture:!0},H=["focus","mousedown","mouseenter","touchstart"],h="mat-ripple-loader-uninitialized",f="mat-ripple-loader-class-name",k="mat-ripple-loader-centered",l="mat-ripple-loader-disabled",ee=(()=>{class n{_document=o(_);_animationsDisabled=C();_globalRippleOptions=o(T,{optional:!0});_platform=o(U);_ngZone=o(y);_injector=o(R);_eventCleanups;_hosts=new Map;constructor(){let e=o(D).createRenderer(null,null);this._eventCleanups=this._ngZone.runOutsideAngular(()=>H.map(t=>e.listen(this._document,t,this._onInteraction,x)))}ngOnDestroy(){let e=this._hosts.keys();for(let t of e)this.destroyRipple(t);this._eventCleanups.forEach(t=>t())}configureRipple(e,t){e.setAttribute(h,this._globalRippleOptions?.namespace??""),(t.className||!e.hasAttribute(f))&&e.setAttribute(f,t.className||""),t.centered&&e.setAttribute(k,""),t.disabled&&e.setAttribute(l,"")}setDisabled(e,t){let r=this._hosts.get(e);r?(r.target.rippleDisabled=t,!t&&!r.hasSetUpEvents&&(r.hasSetUpEvents=!0,r.renderer.setupTriggerEvents(e))):t?e.setAttribute(l,""):e.removeAttribute(l)}_onInteraction=e=>{let t=A(e);if(t instanceof HTMLElement){let r=t.closest(`[${h}="${this._globalRippleOptions?.namespace??""}"]`);r&&this._createRipple(r)}};_createRipple(e){if(!this._document||this._hosts.has(e))return;e.querySelector(".mat-ripple")?.remove();let t=this._document.createElement("span");t.classList.add("mat-ripple",e.getAttribute(f)),e.append(t);let r=this._globalRippleOptions,c=this._animationsDisabled?0:r?.animation?.enterDuration??b.enterDuration,w=this._animationsDisabled?0:r?.animation?.exitDuration??b.exitDuration,u={rippleDisabled:this._animationsDisabled||r?.disabled||e.hasAttribute(l),rippleConfig:{centered:e.hasAttribute(k),terminateOnPointerUp:r?.terminateOnPointerUp,animation:{enterDuration:c,exitDuration:w}}},g=new P(u,this._ngZone,t,this._platform,this._injector),v=!u.rippleDisabled;v&&g.setupTriggerEvents(e),this._hosts.set(e,{target:u,renderer:g,hasSetUpEvents:v}),e.removeAttribute(h)}destroyRipple(e){let t=this._hosts.get(e);t&&(t.renderer._removeTriggerEvents(),this._hosts.delete(e))}static \u0275fac=function(t){return new(t||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();export{ee as a,j as b};
