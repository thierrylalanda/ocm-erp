import{a as b}from"./chunk-H5RQM42I.js";import{b as h}from"./chunk-6P5VJYPL.js";import{a as s,c as d}from"./chunk-HOOCBFFS.js";import{I as i,ha as u,la as p,r as a,s as l,v as c}from"./chunk-RKWTZGMB.js";var f=class o{constructor(e,t){this.http=e;this.authService=t}apiUrl=`${b.api}hierarchie/sites`;getSites(e){let t=new s;return e.page!==void 0&&(t=t.set("page",e.page.toString())),e.size!==void 0&&(t=t.set("size",e.size.toString())),e.societeId!==void 0&&(t=t.set("societeId",e.societeId.toString())),e.type&&(t=t.set("type",e.type)),e.actif!==void 0&&(t=t.set("actif",e.actif.toString())),e.ville&&(t=t.set("ville",e.ville)),e.pays&&(t=t.set("pays",e.pays)),this.http.get(this.apiUrl,{params:t}).pipe(i(r=>this.handleError(r,"Erreur lors de la r\xE9cup\xE9ration des sites")))}getSite(e){return this.http.get(`${this.apiUrl}/${e}`).pipe(i(t=>this.handleError(t,"Site non trouv\xE9")))}createSite(e){return this.http.post(this.apiUrl,e).pipe(i(t=>this.handleError(t,"Erreur lors de la cr\xE9ation du site")))}updateSite(e,t){return this.http.put(`${this.apiUrl}/${e}`,t).pipe(i(r=>this.handleError(r,"Erreur lors de la mise \xE0 jour du site")))}deleteSite(e){return this.http.delete(`${this.apiUrl}/${e}`).pipe(i(t=>this.handleError(t,"Erreur lors de la suppression du site")))}toggleSiteStatus(e,t){return this.http.patch(`${this.apiUrl}/${e}/status`,{actif:t}).pipe(i(r=>this.handleError(r,"Erreur lors du changement de statut")))}getCurrentUserSocieteId(){return this.authService.user?.societeId||null}handleError(e,t){let r=t;if(e.error instanceof ErrorEvent)r=`Erreur: ${e.error.message}`;else switch(e.status){case 400:r="Donn\xE9es invalides. V\xE9rifiez les champs du formulaire.",e.error?.message&&(r+=` ${e.error.message}`);break;case 401:r="Non autoris\xE9. Veuillez vous reconnecter.";break;case 403:r="Acc\xE8s interdit. Vous n'avez pas les permissions n\xE9cessaires.";break;case 404:r="Site non trouv\xE9.";break;case 409:r="Un site avec ce code existe d\xE9j\xE0 pour cette soci\xE9t\xE9.";break;case 500:r="Erreur serveur. Veuillez r\xE9essayer plus tard.";break;case 503:r="Service temporairement indisponible. Veuillez r\xE9essayer.";break;default:r=`${t} (Code: ${e.status})`,e.error?.message&&(r+=` - ${e.error.message}`)}return console.error("Site Service Error:",{status:e.status,message:r,error:e.error}),l(()=>new Error(r))}checkCodeAvailability(e,t,r){let n=new s().set("code",e).set("societeId",t.toString());return r&&(n=n.set("excludeId",r.toString())),this.http.get(`${this.apiUrl}/check-code`,{params:n}).pipe(c(v=>v.available),i(()=>a(!0)))}exportSitesToCsv(e){let t=new s;return e.societeId!==void 0&&(t=t.set("societeId",e.societeId.toString())),e.type&&(t=t.set("type",e.type)),e.actif!==void 0&&(t=t.set("actif",e.actif.toString())),this.http.get(`${this.apiUrl}/export/csv`,{params:t,responseType:"blob"}).pipe(i(r=>this.handleError(r,"Erreur lors de l'export")))}getSiteStatistics(e){let t=new s().set("societeId",e.toString());return this.http.get(`${this.apiUrl}/statistics`,{params:t}).pipe(i(()=>a({total:0,actifs:0,inactifs:0,parType:{},parVille:{},parPays:{}})))}static \u0275fac=function(t){return new(t||o)(p(d),p(h))};static \u0275prov=u({token:o,factory:o.\u0275fac,providedIn:"root"})};export{f as a};
