{
  "version": 3,
  "sources": ["src/app/modules/manage-users/application/use-cases/create-user.use-case.token.ts", "src/app/modules/manage-users/application/use-cases/create-user.use-case.ts"],
  "sourcesContent": ["import { InjectionToken } from '@angular/core';\nimport { CreateUserUseCase } from './create-user.use-case';\n\n/**\n * Token d'injection pour CreateUserUseCase\n */\nexport const CREATE_USER_USE_CASE = new InjectionToken<CreateUserUseCase>('CreateUserUseCase');\n", "import { Inject, Injectable } from '@angular/core';\nimport { UserEntity, UserCreateCommand } from '../../domain/entities/user.entity';\nimport { UserRepository, USER_REPOSITORY } from '../../domain/repositories/user.repository';\nimport { CreateUserDto, UserMapper, UserResponseDto } from '../dto/create-user.dto';\n\n/**\n * Interface pour le use case de création d'utilisateur\n */\nexport interface CreateUserUseCase {\n  execute(dto: CreateUserDto): Promise<UserResponseDto>;\n}\n\n@Injectable()\nexport class CreateUserUseCaseImpl implements CreateUserUseCase {\n  constructor(\n    @Inject(USER_REPOSITORY) private readonly userRepository: UserRepository\n  ) {}\n\n  async execute(dto: CreateUserDto): Promise<UserResponseDto> {\n    // Validation des données\n    this.validateCreateUserDto(dto);\n\n    // Vérifier si un utilisateur avec le même email existe déjà\n    const existingByEmail = await this.userRepository.findByEmail(dto.email);\n    if (existingByEmail) {\n     // throw new Error(`Un utilisateur avec l'email ${dto.email} existe déjà`);\n    }\n\n    // Vérifier si un utilisateur avec le même nom d'utilisateur existe déjà\n    const existingByUsername = await this.userRepository.findByUsername(dto.userName);\n    if (existingByUsername) {\n     // throw new Error(`Un utilisateur avec le nom d'utilisateur ${dto.userName} existe déjà`);\n    }\n\n    // Convertir le DTO en commande de création\n    const createCommand = UserMapper.toCreateCommand(dto);\n\n    // Créer l'entité utilisateur\n    const userEntity = UserEntity.create(createCommand);\n\n    // Sauvegarder dans le repository\n    const savedUser = await this.userRepository.create(userEntity);\n\n    // Convertir en DTO de réponse\n    return UserMapper.toResponseDto(savedUser);\n  }\n\n  /**\n   * Valide les données de création d'utilisateur\n   */\n  private validateCreateUserDto(dto: CreateUserDto): void {\n    const errors: string[] = [];\n\n    if (!dto.nomPrenom || dto.nomPrenom.trim().length === 0) {\n      errors.push('Le nom et prénom sont requis');\n    }\n\n    if (!dto.userName || dto.userName.trim().length === 0) {\n      errors.push(\"Le nom d'utilisateur est requis\");\n    }\n\n    if (!dto.email || !this.isValidEmail(dto.email)) {\n      errors.push('Un email valide est requis');\n    }\n\n\n    if (!dto.password || dto.password.trim().length < 6) {\n      errors.push('Le mot de passe doit contenir au moins 6 caractères');\n    }\n\n    if (!dto.pwdText || dto.pwdText.trim().length === 0) {\n      errors.push('Le texte du mot de passe est requis');\n    }\n\n    if (!dto.societeId || dto.societeId <= 0) {\n      errors.push('Un identifiant de société valide est requis');\n    }\n\n    if (!dto.siteId || dto.siteId <= 0) {\n      errors.push('Un identifiant de site valide est requis');\n    }\n\n    if (!dto.departementId || dto.departementId <= 0) {\n      errors.push('Un identifiant de département valide est requis');\n    }\n\n    if (!dto.statut) {\n      errors.push('Le statut est requis');\n    }\n\n    if (errors.length > 0) {\n      throw new Error(`Validation échouée: ${errors.join(', ')}`);\n    }\n  }\n\n  /**\n   * Valide le format d'email\n   */\n  private isValidEmail(email: string): boolean {\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    return emailRegex.test(email);\n  }\n\n  /**\n   * Valide le numéro de téléphone\n   */\n  private isValidPhoneNumber(phone: string): boolean {\n    const phoneRegex = /^[\\d\\s\\-\\+\\(\\)]{8,20}$/;\n    return phoneRegex.test(phone);\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAMO,IAAM,uBAAuB,IAAI,eAAkC,mBAAmB;;;ACOvF,IAAO,wBAAP,MAAO,uBAAqB;EAEY;EAD5C,YAC4C,gBAA8B;AAA9B,SAAA,iBAAA;EACzC;EAEG,QAAQ,KAAkB;;AAE9B,WAAK,sBAAsB,GAAG;AAG9B,YAAM,kBAAkB,MAAM,KAAK,eAAe,YAAY,IAAI,KAAK;AACvE,UAAI,iBAAiB;MAErB;AAGA,YAAM,qBAAqB,MAAM,KAAK,eAAe,eAAe,IAAI,QAAQ;AAChF,UAAI,oBAAoB;MAExB;AAGA,YAAM,gBAAgB,WAAW,gBAAgB,GAAG;AAGpD,YAAM,aAAa,WAAW,OAAO,aAAa;AAGlD,YAAM,YAAY,MAAM,KAAK,eAAe,OAAO,UAAU;AAG7D,aAAO,WAAW,cAAc,SAAS;IAC3C;;;;;EAKQ,sBAAsB,KAAkB;AAC9C,UAAM,SAAmB,CAAA;AAEzB,QAAI,CAAC,IAAI,aAAa,IAAI,UAAU,KAAI,EAAG,WAAW,GAAG;AACvD,aAAO,KAAK,iCAA8B;IAC5C;AAEA,QAAI,CAAC,IAAI,YAAY,IAAI,SAAS,KAAI,EAAG,WAAW,GAAG;AACrD,aAAO,KAAK,iCAAiC;IAC/C;AAEA,QAAI,CAAC,IAAI,SAAS,CAAC,KAAK,aAAa,IAAI,KAAK,GAAG;AAC/C,aAAO,KAAK,4BAA4B;IAC1C;AAGA,QAAI,CAAC,IAAI,YAAY,IAAI,SAAS,KAAI,EAAG,SAAS,GAAG;AACnD,aAAO,KAAK,wDAAqD;IACnE;AAEA,QAAI,CAAC,IAAI,WAAW,IAAI,QAAQ,KAAI,EAAG,WAAW,GAAG;AACnD,aAAO,KAAK,qCAAqC;IACnD;AAEA,QAAI,CAAC,IAAI,aAAa,IAAI,aAAa,GAAG;AACxC,aAAO,KAAK,mDAA6C;IAC3D;AAEA,QAAI,CAAC,IAAI,UAAU,IAAI,UAAU,GAAG;AAClC,aAAO,KAAK,0CAA0C;IACxD;AAEA,QAAI,CAAC,IAAI,iBAAiB,IAAI,iBAAiB,GAAG;AAChD,aAAO,KAAK,oDAAiD;IAC/D;AAEA,QAAI,CAAC,IAAI,QAAQ;AACf,aAAO,KAAK,sBAAsB;IACpC;AAEA,QAAI,OAAO,SAAS,GAAG;AACrB,YAAM,IAAI,MAAM,6BAAuB,OAAO,KAAK,IAAI,CAAC,EAAE;IAC5D;EACF;;;;EAKQ,aAAa,OAAa;AAChC,UAAM,aAAa;AACnB,WAAO,WAAW,KAAK,KAAK;EAC9B;;;;EAKQ,mBAAmB,OAAa;AACtC,UAAM,aAAa;AACnB,WAAO,WAAW,KAAK,KAAK;EAC9B;;qCAhGW,wBAAqB,mBAEtB,eAAe,CAAA;EAAA;4EAFd,wBAAqB,SAArB,uBAAqB,UAAA,CAAA;;;sEAArB,uBAAqB,CAAA;UADjC;;UAGI;WAAO,eAAe;;;",
  "names": []
}
