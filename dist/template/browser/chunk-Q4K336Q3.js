import{ha as u,ka as i,la as g}from"./chunk-RKWTZGMB.js";import{f as r}from"./chunk-EQDQRRRY.js";var U=new i("UserRepository"),l=class{findWithOptions(e){return r(this,null,function*(){let t=yield this.findAllPaginated(e);return{users:t.content.map(n=>this.mapResponseToUser(n)),total:t.totalElements,hasMore:t.page<t.totalPages-1,currentPage:t.page,totalPages:t.totalPages}})}countByStatus(e){return r(this,null,function*(){return(yield this.findByStatus(e)).totalElements})}countBySite(e){return r(this,null,function*(){return(yield this.findBySite(e)).totalElements})}countByDepartment(e){return r(this,null,function*(){return(yield this.findByDepartment(e)).totalElements})}findActiveUsers(e){return r(this,null,function*(){return this.findByStatus("ACTIF",e)})}findInactiveUsers(e){return r(this,null,function*(){return this.findByStatus("INACTIF",e)})}};var F=new i("CreateUserUseCase");var V=new i("GetUsersUseCase");var o=class s{constructor(e,t,n,m,p,d,h,P,I,b,y,C,x,f,N,R,w,v,S,D,E,T){this.id=e;this.nomPrenom=t;this.telephone=n;this.adresse=m;this.userName=p;this.email=d;this.pwdText=h;this.statut=P;this.societeId=I;this.societeNom=b;this.siteId=y;this.siteNom=C;this.departementId=x;this.departementNom=f;this.derniereConnexion=N;this.tentativesConnexion=R;this.photo=w;this.signature=v;this.langue=S;this.dateCreation=D;this.permissions=E;this.roles=T}static create(e){let t=new Date,n={value:0};return new s(n,e.nomPrenom,e.telephone,e.adresse,e.userName,e.email,e.pwdText,e.statut,e.societeId,"",e.siteId,"",e.departementId,"",null,0,e.photo,e.signature,e.langue,t,[],[])}update(e){return new s(this.id,e.nomPrenom??this.nomPrenom,e.telephone??this.telephone,e.adresse??this.adresse,e.userName??this.userName,e.email??this.email,this.pwdText,e.statut??this.statut,this.societeId,this.societeNom,e.siteId??this.siteId,this.siteNom,e.departementId??this.departementId,this.departementNom,this.derniereConnexion,this.tentativesConnexion,e.photo??this.photo,e.signature??this.signature,e.langue??this.langue,this.dateCreation,[],[])}deactivate(){return new s(this.id,this.nomPrenom,this.telephone,this.adresse,this.userName,this.email,this.pwdText,"INACTIF",this.societeId,this.societeNom,this.siteId,this.siteNom,this.departementId,this.departementNom,this.derniereConnexion,this.tentativesConnexion,this.photo,this.signature,this.langue,this.dateCreation,[],[])}activate(){return new s(this.id,this.nomPrenom,this.telephone,this.adresse,this.userName,this.email,this.pwdText,"ACTIF",this.societeId,this.societeNom,this.siteId,this.siteNom,this.departementId,this.departementNom,this.derniereConnexion,this.tentativesConnexion,this.photo,this.signature,this.langue,this.dateCreation,[],[])}recordLogin(){return new s(this.id,this.nomPrenom,this.telephone,this.adresse,this.userName,this.email,this.pwdText,this.statut,this.societeId,this.societeNom,this.siteId,this.siteNom,this.departementId,this.departementNom,new Date,this.tentativesConnexion+1,this.photo,this.signature,this.langue,this.dateCreation,[],[])}isActive(){return this.statut==="ACTIF"}getFullName(){return this.nomPrenom}getIdValue(){return this.id.value}};var a=class{static toCreateCommand(e){return{nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,password:e.password,email:e.email,pwdText:e.pwdText,societeId:e.societeId,siteId:e.siteId,departementId:e.departementId,statut:e.statut,photo:e.photo,signature:e.signature,langue:e.langue}}static toUpdateCommand(e){return{nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,email:e.email,statut:e.statut,siteId:e.siteId,societeId:e.societeId,departementId:e.departementId,photo:e.photo,signature:e.signature,langue:e.langue}}static toUser(e){return{id:{value:e.id},nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,email:e.email,pwdText:e.pwdText,statut:e.statut,societeId:e.societeId,societeNom:e.societeNom,siteId:e.siteId,siteNom:e.siteNom,departementId:e.departementId,departementNom:e.departementNom,derniereConnexion:e.derniereConnexion?new Date(e.derniereConnexion):null,tentativesConnexion:e.tentativesConnexion,photo:e.photo,signature:e.signature,langue:e.langue,dateCreation:new Date(e.dateCreation)}}static toResponseDto(e){return{id:e.id||0,nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,email:e.email,pwdText:e.pwdText,statut:e.statut,societeId:e.societeId,societeNom:e.societeNom||"",siteId:e.siteId,siteNom:e.siteNom||"",departementId:e.departementId,departementNom:e.departementNom||"",derniereConnexion:e.derniereConnexion?e.derniereConnexion:null,tentativesConnexion:e.tentativesConnexion||0,photo:e.photo,signature:e.signature,langue:e.langue,dateCreation:e.dateCreation?e.dateCreation.toISOString():new Date().toISOString(),roles:e.roles||[],permissions:e.permissions||[]}}static toPagedResponseDto(e){return{content:e.content?.map(t=>this.toResponseDto(t))||[],page:e.page||0,size:e.size||10,totalElements:e.totalElements||0,totalPages:e.totalPages||0}}};var c=class s{constructor(e){this.userRepository=e}execute(e){return r(this,null,function*(){this.validateCreateUserDto(e);let t=yield this.userRepository.findByEmail(e.email),n=yield this.userRepository.findByUsername(e.userName),m=a.toCreateCommand(e),p=o.create(m),d=yield this.userRepository.create(p);return a.toResponseDto(d)})}validateCreateUserDto(e){let t=[];if((!e.nomPrenom||e.nomPrenom.trim().length===0)&&t.push("Le nom et pr\xE9nom sont requis"),(!e.userName||e.userName.trim().length===0)&&t.push("Le nom d'utilisateur est requis"),(!e.email||!this.isValidEmail(e.email))&&t.push("Un email valide est requis"),(!e.password||e.password.trim().length<6)&&t.push("Le mot de passe doit contenir au moins 6 caract\xE8res"),(!e.pwdText||e.pwdText.trim().length===0)&&t.push("Le texte du mot de passe est requis"),(!e.societeId||e.societeId<=0)&&t.push("Un identifiant de soci\xE9t\xE9 valide est requis"),(!e.siteId||e.siteId<=0)&&t.push("Un identifiant de site valide est requis"),(!e.departementId||e.departementId<=0)&&t.push("Un identifiant de d\xE9partement valide est requis"),e.statut||t.push("Le statut est requis"),t.length>0)throw new Error(`Validation \xE9chou\xE9e: ${t.join(", ")}`)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}isValidPhoneNumber(e){return/^[\d\s\-\+\(\)]{8,20}$/.test(e)}static \u0275fac=function(t){return new(t||s)(g(U))};static \u0275prov=u({token:s,factory:s.\u0275fac})};export{U as a,l as b,F as c,V as d,o as e,a as f,c as g};
