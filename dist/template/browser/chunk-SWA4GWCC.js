import{ha as g,ka as r,la as u}from"./chunk-RKWTZGMB.js";import{f as l}from"./chunk-EQDQRRRY.js";var p=new r("CompanyRepository");var Y=new r("CreateCompanyUseCase");var n=class i{constructor(e,t,s,a,o,c,b,f,x,C,v,U,R,A,w,T,D,N,E,B,P,I=void 0,z=void 0,S=void 0,j=void 0,F=void 0,O=void 0,$=void 0){this.id=e;this.nom=t;this.code=s;this.description=a;this.logoUrl=o;this.website=c;this.email=b;this.phoneNumber=f;this.address=x;this.city=C;this.country=v;this.timezone=U;this.language=R;this.currency=A;this.isActive=w;this.subscriptionPlan=T;this.subscriptionExpiresAt=D;this.maxUsers=N;this.createdAt=E;this.updatedAt=B;this.deletedAt=P;this.activity=I;this.postalBox=z;this.region=S;this.taxNumber=j;this.tradeRegister=F;this.fiscalRegime=O;this.faviconUrl=$}static create(e){let t=new Date,s={value:this.generateId()};return new i(e.id,e.nom,e.code,e.description,void 0,void 0,e.email,e.phoneNumber,e.address,e.city,e.pays,e.timezone||"UTC",e.language||"fr",e.currency||"XAF",!0,void 0,void 0,e.maxUsers||10,t,t,void 0,e.activite,e.postalBox,e.region,e.taxNumber,e.tradeRegister,e.fiscalRegime,e.faviconUrl)}update(e){return new i(this.id,e.nom??this.nom,this.code,e.description??this.description,e.logoUrl??this.logoUrl,e.website??this.website,e.email??this.email,e.phoneNumber??this.phoneNumber,e.address??this.address,e.city??this.city,e.country??this.country,e.timezone??this.timezone,e.language??this.language,e.currency??this.currency,e.isActive??this.isActive,this.subscriptionPlan,this.subscriptionExpiresAt,e.maxUsers??this.maxUsers,this.createdAt,new Date,this.deletedAt,e.activity??this.activity,e.postalBox??this.postalBox,e.region??this.region,e.taxNumber??this.taxNumber,e.tradeRegister??this.tradeRegister,e.fiscalRegime??this.fiscalRegime,e.faviconUrl??this.faviconUrl)}markAsDeleted(){return new i(this.id,this.nom,this.code,this.description,this.logoUrl,this.website,this.email,this.phoneNumber,this.address,this.city,this.country,this.timezone,this.language,this.currency,!1,this.subscriptionPlan,this.subscriptionExpiresAt,this.maxUsers,this.createdAt,new Date,new Date,this.activity,this.postalBox,this.region,this.taxNumber,this.tradeRegister,this.fiscalRegime,this.faviconUrl)}activate(){return new i(this.id,this.nom,this.code,this.description,this.logoUrl,this.website,this.email,this.phoneNumber,this.address,this.city,this.country,this.timezone,this.language,this.currency,!0,this.subscriptionPlan,this.subscriptionExpiresAt,this.maxUsers,this.createdAt,new Date,this.deletedAt,this.activity,this.postalBox,this.region,this.taxNumber,this.tradeRegister,this.fiscalRegime,this.faviconUrl)}deactivate(){return new i(this.id,this.nom,this.code,this.description,this.logoUrl,this.website,this.email,this.phoneNumber,this.address,this.city,this.country,this.timezone,this.language,this.currency,!1,this.subscriptionPlan,this.subscriptionExpiresAt,this.maxUsers,this.createdAt,new Date,this.deletedAt,this.activity,this.postalBox,this.region,this.taxNumber,this.tradeRegister,this.fiscalRegime,this.faviconUrl)}updateSubscription(e,t){return new i(this.id,this.nom,this.code,this.description,this.logoUrl,this.website,this.email,this.phoneNumber,this.address,this.city,this.country,this.timezone,this.language,this.currency,this.isActive,e,t,this.maxUsers,this.createdAt,new Date,this.deletedAt,this.activity,this.postalBox,this.region,this.taxNumber,this.tradeRegister,this.fiscalRegime,this.faviconUrl)}canAddMoreUsers(e){return e<this.maxUsers}isSubscriptionActive(){return this.subscriptionExpiresAt?this.subscriptionExpiresAt>new Date:!1}static generateId(){return`tenant_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}};function h(i){return{nom:i.nom,id:i.id,code:y(i.nom),description:i.activite,email:i.email,phoneNumber:i.telephone,address:i.adresse,city:i.region,country:i.pays,currency:i.devise,activity:i.activite,postalBox:i.boitePostal,region:i.region,taxNumber:i.nc,tradeRegister:i.rccm,fiscalRegime:i.regimeFiscal,website:i.siteWeb,logoUrl:i.logo,faviconUrl:i.favicon,isActive:i.actif,maxUsers:10,timezone:"UTC",language:"fr"}}function d(i){return{id:i.id.value,nom:i.name,activite:i.activity||i.description||"",adresse:i.address,boitePostal:i.postalBox,pays:i.country,region:i.region||i.city,telephone:i.phoneNumber,nc:i.taxNumber||"",rccm:i.tradeRegister||"",regimeFiscal:i.fiscalRegime||"",devise:i.currency,email:i.email,siteWeb:i.website,logo:i.logoUrl,favicon:i.faviconUrl,actif:i.isActive,createdAt:i.createdAt.toISOString(),updatedAt:i.updatedAt.toISOString()}}function y(i){let e=i.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toUpperCase().replace(/[^A-Z]/g,""),t=e.substring(0,Math.min(3,e.length)),s=Date.now().toString().slice(-4);return`${t}${s}`}var m=class i{constructor(e){this.companyRepository=e}execute(e){return l(this,null,function*(){if(this.validateCreateCompanyDto(e),yield this.companyRepository.findByEmail(e.email))throw new Error(`Une soci\xE9t\xE9 avec l'email ${e.email} existe d\xE9j\xE0`);if(e.nc&&(yield this.companyRepository.findByTaxNumber(e.nc)))throw new Error(`Une soci\xE9t\xE9 avec le num\xE9ro contribuable ${e.nc} existe d\xE9j\xE0`);if(e.rccm&&(yield this.companyRepository.findByTradeRegister(e.rccm)))throw new Error(`Une soci\xE9t\xE9 avec le RCCM ${e.rccm} existe d\xE9j\xE0`);let s=h(e),a=n.create(s),o=yield this.companyRepository.create(a);return d(o)})}validateCreateCompanyDto(e){let t=[];if((!e.nom||e.nom.trim().length===0)&&t.push("Le nom de la soci\xE9t\xE9 est requis"),(!e.activite||e.activite.trim().length===0)&&t.push("L'activit\xE9 de la soci\xE9t\xE9 est requise"),(!e.email||!this.isValidEmail(e.email))&&t.push("Un email valide est requis"),(!e.nc||e.nc.trim().length===0)&&t.push("Le num\xE9ro contribuable (NC) est requis"),(!e.rccm||e.rccm.trim().length===0)&&t.push("Le RCCM est requis"),(!e.regimeFiscal||e.regimeFiscal.trim().length===0)&&t.push("Le r\xE9gime fiscal est requis"),(!e.devise||e.devise.trim().length===0)&&t.push("La devise est requise"),t.length>0)throw new Error(`Validation failed: ${t.join(", ")}`)}isValidEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static \u0275fac=function(t){return new(t||i)(u(p))};static \u0275prov=g({token:i,factory:i.\u0275fac})};export{p as a,Y as b,h as c,d,m as e};
