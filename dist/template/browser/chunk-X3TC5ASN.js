import{a as g,b as E,c as S,d as O,e as m,f as d,g as D}from"./chunk-Q4K336Q3.js";import{a as w}from"./chunk-H5RQM42I.js";import{d as R,i as C}from"./chunk-5IGNUQZL.js";import"./chunk-G64D4X4E.js";import{a as p,c as y}from"./chunk-HOOCBFFS.js";import"./chunk-E22WOTPK.js";import{Ic as I,Ub as f,ha as l,la as u,ub as P}from"./chunk-RKWTZGMB.js";import{f as o}from"./chunk-EQDQRRRY.js";var n=class{static toEntity(e){let t={value:e.id};return new m(t,e.nomPrenom,e.telephone,e.adresse,e.userName,e.email,e.pwdText,e.statut,e.societeId,e.societeNom,e.siteId,e.siteNom,e.departementId,e.departementNom,e.derniereConnexion?new Date(e.derniereConnexion):null,e.tentativesConnexion,e.photo,e.signature,e.langue,new Date(e.dateCreation),e.permissions,e.roles)}static fromResponseToEntity(e){let t={value:e.id};return new m(t,e.nomPrenom,e.telephone,e.adresse,e.userName,e.email,e.pwdText,e.statut,e.societeId,e.societeNom,e.siteId,e.siteNom,e.departementId,e.departementNom,e.derniereConnexion?new Date(e.derniereConnexion):null,e.tentativesConnexion,e.photo,e.signature,e.langue,new Date(e.dateCreation),e.permissions,e.roles)}static toResponseDto(e){return{id:e.getIdValue(),nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,email:e.email,pwdText:e.pwdText,statut:e.statut,societeId:e.societeId,societeNom:e.societeNom,siteId:e.siteId,siteNom:e.siteNom,departementId:e.departementId,departementNom:e.departementNom,derniereConnexion:e.derniereConnexion?e.derniereConnexion.toISOString():null,tentativesConnexion:e.tentativesConnexion,photo:e.photo,signature:e.signature,langue:e.langue,dateCreation:e.dateCreation.toISOString(),permissions:e.permissions,roles:e.roles}}static toCreateCommand(e){return{nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,password:e.password,email:e.email,pwdText:e.pwdText,societeId:e.societeId,siteId:e.siteId,departementId:e.departementId,statut:e.statut,photo:e.photo,signature:e.signature,langue:e.langue}}static toUpdateCommand(e){return{nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,email:e.email,statut:e.statut,siteId:e.siteId,departementId:e.departementId,photo:e.photo,signature:e.signature,langue:e.langue}}static toApiCreateObject(e){return{nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,password:e.pwdText,email:e.email,pwdText:e.pwdText,societeId:e.societeId,siteId:e.siteId,departementId:e.departementId,statut:e.statut,photo:e.photo,signature:e.signature,langue:e.langue}}static toApiUpdateObject(e){return{nomPrenom:e.nomPrenom,id:e.id,societeId:e.societeId,telephone:e.telephone,adresse:e.adresse,userName:e.userName,email:e.email,statut:e.statut,siteId:e.siteId,departementId:e.departementId,photo:e.photo,signature:e.signature,langue:e.langue}}static fromApiResponse(e){return{id:e.id,nomPrenom:e.nomPrenom,telephone:e.telephone,adresse:e.adresse,userName:e.userName,email:e.email,pwdText:e.pwdText,statut:e.statut,societeId:e.societeId,societeNom:e.societeNom,siteId:e.siteId,siteNom:e.siteNom,departementId:e.departementId,departementNom:e.departementNom,derniereConnexion:e.derniereConnexion,tentativesConnexion:e.tentativesConnexion,photo:e.photo,signature:e.signature,langue:e.langue,dateCreation:e.dateCreation,permissions:e.permissions,roles:e.roles}}static fromApiPagedResponse(e){return{content:e.content?.map(t=>this.fromApiResponse(t))||[],page:e.page,size:e.size,totalElements:e.totalElements,totalPages:e.totalPages}}};var h=class i extends E{constructor(t,r){super();this.http=t;this.localStorage=r}baseUrl=w.api+"hierarchie/utilisateurs";mapResponseToUser(t){return n.fromResponseToEntity(t)}mapUserToCreateCommand(t){let r=t instanceof m?t:new m(t.id,t.nomPrenom,t.telephone,t.adresse,t.userName,t.email,t.pwdText,t.statut,t.societeId,t.societeNom,t.siteId,t.siteNom,t.departementId,t.departementNom,t.derniereConnexion,t.tentativesConnexion,t.photo,t.signature,t.langue,t.dateCreation,t.permissions,t.roles);return{nomPrenom:r.nomPrenom,telephone:r.telephone,adresse:r.adresse,userName:r.userName,password:r.pwdText,email:r.email,pwdText:r.pwdText,societeId:r.societeId,siteId:r.siteId,departementId:r.departementId,statut:r.statut,photo:r.photo,signature:r.signature,langue:r.langue}}mapUserToUpdateCommand(t){let r=t instanceof m?t:new m(t.id,t.nomPrenom,t.telephone,t.adresse,t.userName,t.email,t.pwdText,t.statut,t.societeId,t.societeNom,t.siteId,t.siteNom,t.departementId,t.departementNom,t.derniereConnexion,t.tentativesConnexion,t.photo,t.signature,t.langue,t.dateCreation,t.permissions,t.roles);return{nomPrenom:r.nomPrenom,telephone:r.telephone,adresse:r.adresse,userName:r.userName,email:r.email,statut:r.statut,siteId:r.siteId,departementId:r.departementId,photo:r.photo,signature:r.signature,langue:r.langue}}findById(t){return o(this,null,function*(){try{let r=yield this.http.get(`${this.baseUrl}/${t.value}`).toPromise(),s=n.fromApiResponse(r);return n.fromResponseToEntity(s)}catch(r){return console.error("Erreur r\xE9cup\xE9ration utilisateur par ID:",r),null}})}findByEmail(t){return o(this,null,function*(){try{let r=new p().set("email",t),s=yield this.http.get(this.baseUrl,{params:r}).toPromise();if(s.content&&s.content.length>0){let a=n.fromApiResponse(s.content[0]);return n.fromResponseToEntity(a)}return null}catch(r){return console.error("Erreur recherche par email:",r),null}})}findByUsername(t){return o(this,null,function*(){try{let r=new p().set("userName",t),s=yield this.http.get(this.baseUrl,{params:r}).toPromise();if(s.content&&s.content.length>0){let a=n.fromApiResponse(s.content[0]);return n.fromResponseToEntity(a)}return null}catch(r){return console.error("Erreur recherche par nom d'utilisateur:",r),null}})}findAllPaginated(t){return o(this,null,function*(){try{let r=new p;t?.page!==void 0&&(r=r.set("page",t.page.toString())),t?.size!==void 0&&(r=r.set("size",t.size.toString())),t?.sortBy&&(r=r.set("sortBy",t.sortBy)),t?.sortOrder&&(r=r.set("sortOrder",t.sortOrder)),t?.search&&(r=r.set("search",t.search));let s=this.getSocieteIdFromLocalStorage();s&&(r=r.set("societeId",s.toString()));let a=yield this.http.get(this.baseUrl,{params:r}).toPromise();return n.fromApiPagedResponse(a)}catch(r){return console.error("Erreur r\xE9cup\xE9ration liste pagin\xE9e utilisateurs:",r),{content:[],page:0,size:10,totalElements:0,totalPages:0}}})}create(t){return o(this,null,function*(){try{let r=this.convertToUserEntity(t),s=n.toApiCreateObject(r);s.societeId||(s.societeId=this.getSocieteIdFromLocalStorage());let a=yield this.http.post(this.baseUrl,s).toPromise(),c=n.fromApiResponse(a);return n.fromResponseToEntity(c)}catch(r){throw console.error("Erreur cr\xE9ation utilisateur:",r),r}})}update(t){return o(this,null,function*(){try{let r=this.convertToUserEntity(t),s=n.toApiUpdateObject(r),a=yield this.http.put(`${this.baseUrl}/${r.getIdValue()}`,s).toPromise(),c=n.fromApiResponse(a);return n.fromResponseToEntity(c)}catch(r){throw console.error("Erreur mise \xE0 jour utilisateur:",r),r}})}delete(t){return o(this,null,function*(){try{yield this.http.delete(`${this.baseUrl}/${t.value}`).toPromise()}catch(r){throw console.error("Erreur suppression utilisateur:",r),r}})}activateUser(t){return o(this,null,function*(){try{let r=yield this.http.patch(`${this.baseUrl}/${t.value}/activate`,{}).toPromise(),s=n.fromApiResponse(r);return n.fromResponseToEntity(s)}catch(r){throw console.error("Erreur activation utilisateur:",r),r}})}deactivateUser(t){return o(this,null,function*(){try{let r=yield this.http.patch(`${this.baseUrl}/${t.value}/deactivate`,{}).toPromise(),s=n.fromApiResponse(r);return n.fromResponseToEntity(s)}catch(r){throw console.error("Erreur d\xE9sactivation utilisateur:",r),r}})}recordLogin(t){return o(this,null,function*(){try{yield this.http.patch(`${this.baseUrl}/${t.value}/record-login`,{}).toPromise()}catch(r){throw console.error("Erreur enregistrement connexion:",r),r}})}searchUsers(t,r){return o(this,null,function*(){try{let s=new p().set("search",t);r?.page!==void 0&&(s=s.set("page",r.page.toString())),r?.size!==void 0&&(s=s.set("size",r.size.toString()));let a=this.getSocieteIdFromLocalStorage();a&&(s=s.set("societeId",a.toString()));let c=yield this.http.get(this.baseUrl,{params:s}).toPromise();return n.fromApiPagedResponse(c)}catch(s){return console.error("Erreur recherche utilisateurs:",s),{content:[],page:0,size:10,totalElements:0,totalPages:0}}})}findByStatus(t,r){return o(this,null,function*(){try{let s=new p().set("statut",t);r?.page!==void 0&&(s=s.set("page",r.page.toString())),r?.size!==void 0&&(s=s.set("size",r.size.toString()));let a=this.getSocieteIdFromLocalStorage();a&&(s=s.set("societeId",a.toString()));let c=yield this.http.get(this.baseUrl,{params:s}).toPromise();return n.fromApiPagedResponse(c)}catch(s){return console.error("Erreur recherche par statut:",s),{content:[],page:0,size:10,totalElements:0,totalPages:0}}})}findBySite(t,r){return o(this,null,function*(){try{let s=new p;r?.page!==void 0&&(s=s.set("page",r.page.toString())),r?.size!==void 0&&(s=s.set("size",r.size.toString()));let a=yield this.http.get(`${this.baseUrl}/site/${t}`,{params:s}).toPromise();return n.fromApiPagedResponse(a)}catch(s){return console.error("Erreur recherche par site:",s),{content:[],page:0,size:10,totalElements:0,totalPages:0}}})}findByDepartment(t,r){return o(this,null,function*(){try{let s=new p;r?.page!==void 0&&(s=s.set("page",r.page.toString())),r?.size!==void 0&&(s=s.set("size",r.size.toString()));let a=yield this.http.get(`${this.baseUrl}/departement/${t}`,{params:s}).toPromise();return n.fromApiPagedResponse(a)}catch(s){return console.error("Erreur recherche par d\xE9partement:",s),{content:[],page:0,size:10,totalElements:0,totalPages:0}}})}findBySociete(t,r){return o(this,null,function*(){try{let s=new p;r?.page!==void 0&&(s=s.set("page",r.page.toString())),r?.size!==void 0&&(s=s.set("size",r.size.toString()));let a=yield this.http.get(`${this.baseUrl}/societe/${t}`,{params:s}).toPromise();return n.fromApiPagedResponse(a)}catch(s){return console.error("Erreur recherche par soci\xE9t\xE9:",s),{content:[],page:0,size:10,totalElements:0,totalPages:0}}})}existsByEmail(t){return o(this,null,function*(){try{return(yield this.findByEmail(t))!==null}catch(r){return console.error("Erreur v\xE9rification email:",r),!1}})}existsByUsername(t){return o(this,null,function*(){try{return(yield this.findByUsername(t))!==null}catch(r){return console.error("Erreur v\xE9rification nom d'utilisateur:",r),!1}})}createMany(t){return o(this,null,function*(){try{let r=[];for(let s of t){let a=yield this.create(s);r.push(a)}return r}catch(r){throw console.error("Erreur cr\xE9ation multiple utilisateurs:",r),r}})}updateMany(t){return o(this,null,function*(){try{let r=[];for(let s of t){let a=yield this.update(s);r.push(a)}return r}catch(r){throw console.error("Erreur mise \xE0 jour multiple utilisateurs:",r),r}})}getSocieteIdFromLocalStorage(){try{let t=this.localStorage.getItem("societeId");return t?parseInt(t,10):0}catch(t){return console.error("Erreur r\xE9cup\xE9ration societeId depuis localStorage:",t),0}}getAuthHeaders(){let t=this.localStorage.getItem("authToken");return t?{Authorization:`Bearer ${t}`}:{}}convertToUserEntity(t){return t instanceof m?t:new m(t.id,t.nomPrenom,t.telephone,t.adresse,t.userName,t.email,t.pwdText,t.statut,t.societeId,t.societeNom,t.siteId,t.siteNom,t.departementId,t.departementNom,t.derniereConnexion,t.tentativesConnexion,t.photo,t.signature,t.langue,t.dateCreation,t.permissions,t.roles)}static \u0275fac=function(r){return new(r||i)(u(y),u("LOCAL_STORAGE"))};static \u0275prov=l({token:i,factory:i.\u0275fac,providedIn:"root"})};var U=class i{constructor(e){this.userRepository=e}execute(e){return o(this,null,function*(){let t=this.mapToPaginationOptions(e),r=yield this.userRepository.findAllPaginated(t);return d.toPagedResponseDto(r)})}mapToPaginationOptions(e){if(!e)return{page:0,size:10};let t={};return e.page!==void 0&&(t.page=e.page),e.size!==void 0&&(t.size=e.size),e.sortBy&&(t.sortBy=e.sortBy),e.sortOrder&&(t.sortOrder=e.sortOrder),e.search&&(t.search=e.search),t}searchUsers(e,t){return o(this,null,function*(){let r=this.mapToPaginationOptions(t),s=yield this.userRepository.searchUsers(e,r);return d.toPagedResponseDto(s)})}getUsersByStatus(e,t){return o(this,null,function*(){let r=this.mapToPaginationOptions(t),s=yield this.userRepository.findByStatus(e,r);return d.toPagedResponseDto(s)})}getUsersBySite(e,t){return o(this,null,function*(){let r=this.mapToPaginationOptions(t),s=yield this.userRepository.findBySite(e,r);return d.toPagedResponseDto(s)})}getUsersByDepartment(e,t){return o(this,null,function*(){let r=this.mapToPaginationOptions(t),s=yield this.userRepository.findByDepartment(e,r);return d.toPagedResponseDto(s)})}getActiveUsers(e){return o(this,null,function*(){return this.getUsersByStatus("ACTIF",e)})}getInactiveUsers(e){return o(this,null,function*(){return this.getUsersByStatus("INACTIF",e)})}executeBySite(e,t){return o(this,null,function*(){return this.getUsersBySite(e,t)})}executeByDepartment(e,t){return o(this,null,function*(){return this.getUsersByDepartment(e,t)})}executeBySociete(e,t){return o(this,null,function*(){let r=this.mapToPaginationOptions(t),s=yield this.userRepository.findBySociete(e,r);return d.toPagedResponseDto(s)})}static \u0275fac=function(t){return new(t||i)(u(g))};static \u0275prov=l({token:i,factory:i.\u0275fac})};var v=class i{static \u0275fac=function(t){return new(t||i)};static \u0275cmp=P({type:i,selectors:[["app-manage-user"]],features:[I([{provide:g,useClass:h},{provide:S,useClass:D},{provide:O,useClass:U},{provide:"LOCAL_STORAGE",useValue:localStorage}])],decls:1,vars:0,template:function(t,r){t&1&&f(0,"router-outlet")},dependencies:[C,R],encapsulation:2})};export{v as ManageUsersComponent};
