{
  "version": 3,
  "sources": ["src/app/modules/stock/application/use-cases/inventory/get-stock-level.use-case.impl.ts", "src/app/modules/stock/application/use-cases/inventory/get-stock-level.use-case.spec.ts"],
  "sourcesContent": ["import { Inject, Injectable } from '@angular/core';\nimport { GetStockLevelUseCase } from './get-stock-level.use-case';\nimport { StockRepository, STOCK_REPOSITORY } from '../../../domain/repositories/stock.repository';\nimport { Result } from '../../../../_shared/domain/types/result.type';\nimport { DomainError } from '../../../../_shared/domain/errors/domain.error';\nimport { InventoryDto } from '../../dto/stock.dto';\n\n/**\n * Implémentation du use case GetStockLevel\n */\n@Injectable()\nexport class GetStockLevelUseCaseImpl implements GetStockLevelUseCase {\n    constructor(\n        @Inject(STOCK_REPOSITORY) private stockRepository: StockRepository\n    ) { }\n\n    async execute(productId?: string, warehouseId?: string): Promise<Result<InventoryDto[], DomainError>> {\n        // Si productId est fourni, on utilise getStockLevel du repository\n        // Sinon, on pourrait avoir besoin d'une méthode pour tout récupérer (ex: inventaire complet)\n        // Pour l'instant le repository a getStockLevel(productId, warehouseId) qui semble cibler un produit.\n        // Si on veut TOUT l'inventaire, il faudrait peut-être une autre méthode ou adapter getStockLevel.\n        // On va supposer ici que si productId est vide, le repository gère ou on utilise une autre méthode.\n        // Vérifions le repository... getStockLevel(productId: string, warehouseId?: string) -> productId est obligatoire dans l'interface actuelle.\n        // Il nous manque une méthode getAllInventory() dans le repository si on veut faire une liste complète sans filtre produit.\n\n        // TEMPORAIRE: Si pas de productId, on essaie de tricher ou on modifie le repo ?\n        // On va modifier le repo interface pour rendre productId optionnel ou ajouter getAllInventory.\n        // Pour l'instant, appelons avec \"\" si nécessaire, mais le mieux est de corriger l'interface repo.\n        // Mais attendez, HttpStockRepository.getStockLevel implémente: const params: any = { productId };\n        // Si productId est undefined, params sera { productId: undefined }.\n\n        // Pour être propre, utilisons getStockLevel avec assert que productId est string si obligatoire, \n        // ou modifions l'interface.\n        // Allons modifier l'interface Repository pour productId optionnel dans une étape suivante si besoin.\n        // Pour ce fichier, implémentons la logique.\n\n        const result = await this.stockRepository.getStockLevel(productId || '', warehouseId);\n\n        if (result.isFailure) {\n            return Result.fail(result.error);\n        }\n\n        const inventory = result.value;\n\n        // Mappage vers DTO\n        const dtos: InventoryDto[] = inventory.map(i => ({\n            id: i.id,\n            productId: i.productId,\n            productName: i.productName || 'Unknown Product',\n            productReference: i.productReference || '-',\n            warehouseId: i.warehouseId,\n            warehouseName: i.warehouseName || 'Unknown Warehouse',\n            quantity: i.quantity,\n            reservedQuantity: i.reservedQuantity,\n            availableQuantity: i.availableQuantity,\n            stockValue: i.stockValue,\n            averageCost: i.averageCost,\n            lastMovementDate: i.lastMovementDate,\n            updatedAt: i.updatedAt\n        }));\n\n        return Result.ok(dtos);\n    }\n}\n", "import { TestBed } from '@angular/core/testing';\nimport { GetStockLevelUseCaseImpl } from './get-stock-level.use-case.impl';\nimport { STOCK_REPOSITORY, StockRepository } from '../../../domain/repositories/stock.repository';\nimport { Result } from '../../../../_shared/domain/types/result.type';\nimport { InfrastructureError } from '../../../../_shared/domain/errors/domain.error';\nimport { Inventory } from '../../../domain/entities/inventory.entity';\n\ndescribe('GetStockLevelUseCaseImpl', () => {\n    let useCase: GetStockLevelUseCaseImpl;\n    let mockStockRepository: jasmine.SpyObj<StockRepository>;\n\n    beforeEach(() => {\n        mockStockRepository = jasmine.createSpyObj('StockRepository', ['getStockLevel']);\n\n        TestBed.configureTestingModule({\n            providers: [\n                GetStockLevelUseCaseImpl,\n                { provide: STOCK_REPOSITORY, useValue: mockStockRepository }\n            ]\n        });\n\n        useCase = TestBed.inject(GetStockLevelUseCaseImpl);\n    });\n\n    it('should be created', () => {\n        expect(useCase).toBeTruthy();\n    });\n\n    it('should return mapped inventory dtos on success', async () => {\n        const mockDate = new Date();\n        const mockInventory: Inventory[] = [{\n            id: '1',\n            productId: 'prod1',\n            productName: 'Product 1',\n            productReference: 'REF1',\n            warehouseId: 'wh1',\n            warehouseName: 'Warehouse 1',\n            quantity: 10,\n            reservedQuantity: 2,\n            availableQuantity: 8,\n            stockValue: 100,\n            averageCost: 10,\n            lastMovementDate: mockDate,\n            updatedAt: mockDate\n        }];\n\n        mockStockRepository.getStockLevel.and.returnValue(Promise.resolve(Result.ok(mockInventory)));\n\n        const result = await useCase.execute();\n\n        expect(result.isSuccess).toBeTrue();\n        expect(result.value.length).toBe(1);\n        expect(result.value[0].productName).toBe('Product 1');\n        expect(result.value[0].availableQuantity).toBe(8);\n        expect(mockStockRepository.getStockLevel).toHaveBeenCalled();\n    });\n\n    it('should propagate error on failure', async () => {\n        const error = new InfrastructureError('Failed');\n        mockStockRepository.getStockLevel.and.returnValue(Promise.resolve(Result.fail(error)));\n\n        const result = await useCase.execute();\n\n        expect(result.isFailure).toBeTrue();\n        expect(result.error).toEqual(error);\n    });\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;IAWa;;;;;AAXb;AAEA;AACA;AAQO,IAAM,2BAAN,MAAMA,0BAAwB;MAEK;MADtC,YACsC,iBAAgC;AAAhC,aAAA,kBAAA;MAClC;MAEE,QAAQ,WAAoB,aAAoB;;AAoBlD,gBAAM,SAAS,MAAM,KAAK,gBAAgB,cAAc,aAAa,IAAI,WAAW;AAEpF,cAAI,OAAO,WAAW;AAClB,mBAAO,OAAO,KAAK,OAAO,KAAK;UACnC;AAEA,gBAAM,YAAY,OAAO;AAGzB,gBAAM,OAAuB,UAAU,IAAI,QAAM;YAC7C,IAAI,EAAE;YACN,WAAW,EAAE;YACb,aAAa,EAAE,eAAe;YAC9B,kBAAkB,EAAE,oBAAoB;YACxC,aAAa,EAAE;YACf,eAAe,EAAE,iBAAiB;YAClC,UAAU,EAAE;YACZ,kBAAkB,EAAE;YACpB,mBAAmB,EAAE;YACrB,YAAY,EAAE;YACd,aAAa,EAAE;YACf,kBAAkB,EAAE;YACpB,WAAW,EAAE;YACf;AAEF,iBAAO,OAAO,GAAG,IAAI;QACzB;;;6CAjDK,QAAM,MAAA,CAAC,gBAAgB,EAAA,CAAA,EAAA;;;AAFnB,+BAAwB,WAAA;MADpC,WAAU;OACE,wBAAwB;;;;;ACXrC;;;AACA;AACA;AACA;AACA;AAGA,aAAS,4BAA4B,MAAK;AACtC,UAAI;AACJ,UAAI;AAEJ,iBAAW,MAAK;AACZ,8BAAsB,QAAQ,aAAa,mBAAmB,CAAC,eAAe,CAAC;AAE/E,gBAAQ,uBAAuB;UAC3B,WAAW;YACP;YACA,EAAE,SAAS,kBAAkB,UAAU,oBAAmB;;SAEjE;AAED,kBAAU,QAAQ,OAAO,wBAAwB;MACrD,CAAC;AAED,SAAG,qBAAqB,MAAK;AACzB,eAAO,OAAO,EAAE,WAAU;MAC9B,CAAC;AAED,SAAG,kDAAkD,MAAW;AAC5D,cAAM,WAAW,oBAAI,KAAI;AACzB,cAAM,gBAA6B,CAAC;UAChC,IAAI;UACJ,WAAW;UACX,aAAa;UACb,kBAAkB;UAClB,aAAa;UACb,eAAe;UACf,UAAU;UACV,kBAAkB;UAClB,mBAAmB;UACnB,YAAY;UACZ,aAAa;UACb,kBAAkB;UAClB,WAAW;SACd;AAED,4BAAoB,cAAc,IAAI,YAAY,QAAQ,QAAQ,OAAO,GAAG,aAAa,CAAC,CAAC;AAE3F,cAAM,SAAS,MAAM,QAAQ,QAAO;AAEpC,eAAO,OAAO,SAAS,EAAE,SAAQ;AACjC,eAAO,OAAO,MAAM,MAAM,EAAE,KAAK,CAAC;AAClC,eAAO,OAAO,MAAM,CAAC,EAAE,WAAW,EAAE,KAAK,WAAW;AACpD,eAAO,OAAO,MAAM,CAAC,EAAE,iBAAiB,EAAE,KAAK,CAAC;AAChD,eAAO,oBAAoB,aAAa,EAAE,iBAAgB;MAC9D,EAAC;AAED,SAAG,qCAAqC,MAAW;AAC/C,cAAM,QAAQ,IAAI,oBAAoB,QAAQ;AAC9C,4BAAoB,cAAc,IAAI,YAAY,QAAQ,QAAQ,OAAO,KAAK,KAAK,CAAC,CAAC;AAErF,cAAM,SAAS,MAAM,QAAQ,QAAO;AAEpC,eAAO,OAAO,SAAS,EAAE,SAAQ;AACjC,eAAO,OAAO,KAAK,EAAE,QAAQ,KAAK;MACtC,EAAC;IACL,CAAC;;;",
  "names": ["GetStockLevelUseCaseImpl"]
}
