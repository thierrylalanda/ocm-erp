{
  "version": 3,
  "sources": ["src/app/core/services/translation/translation.service.ts", "src/app/core/services/translation/translate.pipe.ts"],
  "sourcesContent": ["import { Injectable, Inject, PLATFORM_ID } from '@angular/core';\nimport { isPlatformBrowser } from '@angular/common';\nimport { HttpClient } from '@angular/common/http';\nimport { BehaviorSubject, Observable, of } from 'rxjs';\nimport { catchError, map, tap } from 'rxjs/operators';\n\nexport interface TranslationData {\n  [key: string]: any;\n}\n\nexport type LanguageCode = 'fr' | 'en';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TranslationService {\n  private readonly DEFAULT_LANGUAGE: LanguageCode = 'fr';\n  private readonly STORAGE_KEY = 'app_language';\n  private readonly TRANSLATIONS_PATH = 'assets/i18n';\n  \n  private translations: TranslationData = {};\n  private currentLanguage$ = new BehaviorSubject<LanguageCode>(this.DEFAULT_LANGUAGE);\n  private translationsLoaded$ = new BehaviorSubject<boolean>(false);\n  private translationsLoaded = false;\n  \n  constructor(\n    private http: HttpClient,\n    @Inject(PLATFORM_ID) private platformId: Object\n  ) {\n    this.initializeLanguage();\n  }\n  \n  /**\n   * Initialize the language based on browser preference or stored preference\n   */\n  private initializeLanguage(): void {\n    let language: LanguageCode = this.DEFAULT_LANGUAGE;\n    \n    if (this.isBrowser()) {\n      // Try to get language from localStorage\n      const storedLanguage = localStorage.getItem(this.STORAGE_KEY) as LanguageCode;\n      if (storedLanguage && this.isValidLanguage(storedLanguage)) {\n        language = storedLanguage;\n      } else {\n        // Try to detect browser language\n        const browserLang = navigator.language.split('-')[0];\n        if (this.isValidLanguage(browserLang as LanguageCode)) {\n          language = browserLang as LanguageCode;\n        }\n      }\n    }\n    \n    this.setLanguage(language, false);\n  }\n  \n  /**\n   * Check if running in browser environment\n   */\n  private isBrowser(): boolean {\n    return isPlatformBrowser(this.platformId);\n  }\n  \n  /**\n   * Check if language code is valid\n   */\n  private isValidLanguage(lang: string): lang is LanguageCode {\n    return ['fr', 'en'].includes(lang);\n  }\n  \n  /**\n   * Load translations for a specific language\n   */\n  private loadTranslations(language: LanguageCode): Observable<TranslationData> {\n    const url = `${this.TRANSLATIONS_PATH}/${language}.json`;\n    \n    return this.http.get<TranslationData>(url).pipe(\n      tap(translations => {\n        this.translations = translations;\n        this.translationsLoaded = true;\n        this.translationsLoaded$.next(true);\n      }),\n      catchError(error => {\n        console.error(`Failed to load translations for ${language}:`, error);\n        // Return empty translations as fallback\n        return of({});\n      })\n    );\n  }\n  \n  /**\n   * Set the current language\n   * @param language Language code ('fr' or 'en')\n   * @param saveToStorage Whether to save to localStorage\n   */\n  setLanguage(language: LanguageCode, saveToStorage: boolean = true): void {\n    if (!this.isValidLanguage(language)) {\n      console.warn(`Invalid language code: ${language}. Using default.`);\n      language = this.DEFAULT_LANGUAGE;\n    }\n    \n    if (this.currentLanguage$.value !== language || !this.translationsLoaded) {\n      this.loadTranslations(language).subscribe(() => {\n        this.currentLanguage$.next(language);\n        \n        if (saveToStorage && this.isBrowser()) {\n          localStorage.setItem(this.STORAGE_KEY, language);\n        }\n      });\n    }\n  }\n  \n  /**\n   * Get the current language\n   */\n  getCurrentLanguage(): LanguageCode {\n    return this.currentLanguage$.value;\n  }\n  \n  /**\n   * Observable for language changes\n   */\n  get languageChanges(): Observable<LanguageCode> {\n    return this.currentLanguage$.asObservable();\n  }\n  \n  /**\n   * Observable for translations loaded state\n   */\n  get translationsLoadedChanges(): Observable<boolean> {\n    return this.translationsLoaded$.asObservable();\n  }\n  \n  /**\n   * Translate a key with optional parameters\n   * @param key Translation key (e.g., 'login.title')\n   * @param params Optional parameters to replace in the translation\n   */\n  translate(key: string, params?: { [key: string]: any }): string {\n    if (!this.translationsLoaded) {\n      return key; // Return key as fallback while loading\n    }\n    \n    // Navigate through nested objects using dot notation\n    const keys = key.split('.');\n    let value: any = this.translations;\n    \n    for (const k of keys) {\n      if (value && typeof value === 'object' && k in value) {\n        value = value[k];\n      } else {\n        return key; // Key not found\n      }\n    }\n    \n    if (typeof value !== 'string') {\n      return key;\n    }\n    \n    // Replace parameters if provided\n    if (params) {\n      return this.replaceParams(value, params);\n    }\n    \n    return value;\n  }\n  \n  /**\n   * Replace parameters in translation string\n   */\n  private replaceParams(text: string, params: { [key: string]: any }): string {\n    return text.replace(/\\{(\\w+)\\}/g, (match, paramName) => {\n      return params[paramName] !== undefined ? params[paramName] : match;\n    });\n  }\n  \n  /**\n   * Get available languages\n   */\n  getAvailableLanguages(): { code: LanguageCode; name: string; flag?: string }[] {\n    return [\n      { code: 'fr', name: 'FranÃ§ais', flag: 'ðŸ‡«ðŸ‡·' },\n      { code: 'en', name: 'English', flag: 'ðŸ‡¬ðŸ‡§' }\n    ];\n  }\n  \n  /**\n   * Check if translations are loaded\n   */\n  isLoaded(): boolean {\n    return this.translationsLoaded;\n  }\n}\n", "import { Pipe, PipeTransform, OnDestroy, ChangeDetectorRef } from '@angular/core';\nimport { TranslationService } from './translation.service';\nimport { Subscription } from 'rxjs';\n\n@Pipe({\n  name: 'translate',\n  pure: false // Make pipe impure to detect language changes\n})\nexport class TranslatePipe implements PipeTransform, OnDestroy {\n  private lastKey: string = '';\n  private lastParams: any = null;\n  private lastValue: string = '';\n  private languageChangeSubscription: Subscription;\n  private translationsLoadedSubscription: Subscription;\n\n  constructor(\n    private translationService: TranslationService,\n    private changeDetectorRef: ChangeDetectorRef\n  ) {\n    // Subscribe to language changes to trigger pipe update\n    this.languageChangeSubscription = this.translationService.languageChanges.subscribe(() => {\n      this.updateTranslation();\n      this.changeDetectorRef.markForCheck();\n    });\n    \n    // Subscribe to translations loaded state changes\n    this.translationsLoadedSubscription = this.translationService.translationsLoadedChanges.subscribe(() => {\n      this.updateTranslation();\n      this.changeDetectorRef.markForCheck();\n    });\n  }\n\n  transform(key: string, params?: { [key: string]: any }): string {\n    // If key or params changed, get new translation\n    if (key !== this.lastKey || JSON.stringify(params) !== JSON.stringify(this.lastParams)) {\n      this.lastKey = key;\n      this.lastParams = params;\n      this.updateTranslation();\n    }\n\n    return this.lastValue;\n  }\n  \n  private updateTranslation(): void {\n    this.lastValue = this.translationService.translate(this.lastKey, this.lastParams);\n  }\n\n  ngOnDestroy(): void {\n    if (this.languageChangeSubscription) {\n      this.languageChangeSubscription.unsubscribe();\n    }\n    if (this.translationsLoadedSubscription) {\n      this.translationsLoadedSubscription.unsubscribe();\n    }\n  }\n}\n"],
  "mappings": "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",
  "names": ["TranslationService", "TranslatePipe"]
}
