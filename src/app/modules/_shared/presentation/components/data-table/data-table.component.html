<div class="data-table-container" [class]="customClass" [style.height]="height">
    <!-- Loading Overlay -->
    <div *ngIf="loading" class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">{{ 'common.loading' | translate }}</span>
        </div>
    </div>

    <!-- Table -->
    <div class="table-responsive">
        <table class="table table-hover">
            <!-- Header -->
            <thead>
                <tr>
                    <!-- Checkbox column (if selectable) -->
                    <th *ngIf="selectable && selectionMode === 'multiple'" class="column-checkbox">
                        <input type="checkbox" class="form-check-input" [checked]="allSelected"
                            (change)="toggleAllRows()" />
                    </th>

                    <!-- Row numbers column -->
                    <th *ngIf="showRowNumbers" class="column-row-number">#</th>

                    <!-- Data columns -->
                    <th *ngFor="let column of columns" [style.width]="column.width" [class.sortable]="column.sortable"
                        [class.text-center]="column.align === 'center'" [class.text-end]="column.align === 'right'"
                        (click)="onSort(column)">
                        <div class="column-header">
                            <span>{{ column.label | translate }}</span>
                            <i *ngIf="column.sortable" class="isax isax-{{ getSortIcon(column) }} ms-1"></i>
                        </div>

                        <!-- Filter input -->
                        <div *ngIf="column.filterable" class="column-filter" (click)="$event.stopPropagation()">
                            <input type="text" class="form-control form-control-sm"
                                [placeholder]="'common.filter' | translate"
                                (input)="onFilter(column, $any($event.target).value)" />
                        </div>
                    </th>
                </tr>
            </thead>

            <!-- Body -->
            <tbody>
                <tr *ngFor="let row of processedData; let i = index" [class.selected]="isRowSelected(i)"
                    [class.clickable]="clickableRows || selectable" (click)="onRowClick(row, i)">
                    <!-- Checkbox column -->
                    <td *ngIf="selectable && selectionMode === 'multiple'" class="column-checkbox">
                        <input type="checkbox" class="form-check-input" [checked]="isRowSelected(i)"
                            (click)="$event.stopPropagation()" (change)="toggleRowSelection(i)" />
                    </td>

                    <!-- Radio button column -->
                    <td *ngIf="selectable && selectionMode === 'single'" class="column-checkbox">
                        <input type="radio" class="form-check-input" [checked]="isRowSelected(i)"
                            (click)="$event.stopPropagation()" (change)="toggleRowSelection(i)" />
                    </td>

                    <!-- Row number -->
                    <td *ngIf="showRowNumbers" class="column-row-number">
                        {{ pagination ? (pagination.currentPage - 1) * pagination.pageSize + i + 1 : i + 1 }}
                    </td>

                    <!-- Data cells -->
                    <td *ngFor="let column of columns" [class.text-center]="column.align === 'center'"
                        [class.text-end]="column.align === 'right'">
                        <ng-container *ngIf="!column.template && !column.actions">
                            {{ formatCellValue(row, column) }}
                        </ng-container>
                        <ng-container *ngIf="column.template">
                            <ng-container
                                *ngTemplateOutlet="column.template; context: { $implicit: row, column: column }"></ng-container>
                        </ng-container>

                        <!-- Actions -->
                        <div *ngIf="column.actions" class="d-flex gap-2"
                            [class.justify-content-center]="column.align === 'center'"
                            [class.justify-content-end]="column.align === 'right'">
                            <button *ngFor="let action of column.actions" type="button" class="btn"
                                [class]="action.class || 'btn-sm btn-light'"
                                (click)="$event.stopPropagation(); action.callback(row)"
                                [title]="action.label | translate">
                                <i *ngIf="action.icon" [class]="'isax ' + action.icon"></i>
                                <span *ngIf="!action.icon" class="ms-1">{{ action.label | translate }}</span>
                            </button>
                        </div>
                    </td>
                </tr>

                <!-- Empty state -->
                <tr *ngIf="processedData.length === 0 && !loading">
                    <td [attr.colspan]="columns.length + (selectable ? 1 : 0) + (showRowNumbers ? 1 : 0)"
                        class="text-center py-5">
                        <div class="empty-state">
                            <i class="isax isax-box-search fs-1 text-muted mb-3"></i>
                            <p class="text-muted mb-0">{{ 'common.noData' | translate }}</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div *ngIf="pagination && processedData.length > 0" class="pagination-container">
        <div class="pagination-info">
            <span>
                {{ 'common.showing' | translate }}
                {{ (pagination.currentPage - 1) * pagination.pageSize + 1 }}
                -
                {{ Math.min(pagination.currentPage * pagination.pageSize, pagination.totalItems) }}
                {{ 'common.of' | translate }}
                {{ pagination.totalItems }}
            </span>
        </div>

        <div class="pagination-controls">
            <!-- Page size selector -->
            <select *ngIf="pagination.pageSizeOptions && pagination.pageSizeOptions.length > 0"
                class="form-select form-select-sm me-3" [value]="pagination.pageSize"
                (change)="onPageSizeChange(+$any($event.target).value)">
                <option *ngFor="let size of pagination.pageSizeOptions" [value]="size">
                    {{ size }} / {{ 'common.page' | translate }}
                </option>
            </select>

            <!-- Page navigation -->
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-sm mb-0">
                    <!-- Previous button -->
                    <li class="page-item" [class.disabled]="pagination.currentPage === 1">
                        <a class="page-link" href="javascript:void(0)"
                            (click)="onPageChange(pagination.currentPage - 1)">
                            <i class="isax isax-arrow-left-2"></i>
                        </a>
                    </li>

                    <!-- Page numbers -->
                    <li *ngFor="let page of getPages()" class="page-item"
                        [class.active]="page === pagination.currentPage">
                        <a class="page-link" href="javascript:void(0)" (click)="onPageChange(page)">
                            {{ page }}
                        </a>
                    </li>

                    <!-- Next button -->
                    <li class="page-item" [class.disabled]="pagination.currentPage === getPages().length">
                        <a class="page-link" href="javascript:void(0)"
                            (click)="onPageChange(pagination.currentPage + 1)">
                            <i class="isax isax-arrow-right-3"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>