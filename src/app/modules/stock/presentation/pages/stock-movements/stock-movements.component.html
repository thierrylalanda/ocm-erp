<div class="stock-movements-page">
    <div class="page-header d-flex justify-content-between align-items-center mb-4">
        <h2 class="h3 mb-0">{{ 'stock.movements.title' | translate }}</h2>
        <div class="d-flex gap-2">
            <div class="btn-group" role="group">
                <button type="button" class="btn" [class.btn-primary]="viewMode === 'list'"
                    [class.btn-outline-primary]="viewMode !== 'list'" (click)="viewMode = 'list'" title="Vue liste">
                    <i class="isax isax-task-square"></i>
                </button>
                <button type="button" class="btn" [class.btn-primary]="viewMode === 'calendar'"
                    [class.btn-outline-primary]="viewMode !== 'calendar'" (click)="viewMode = 'calendar'"
                    title="Vue calendrier">
                    <i class="isax isax-calendar-1"></i>
                </button>
            </div>
            <button class="btn btn-primary" (click)="openCreateModal()">
                <i class="isax isax-add-circle me-2"></i>
                {{ 'stock.movements.create' | translate }}
            </button>
        </div>
    </div>

    <!-- Filters -->
    <div class="card mb-4">
        <div class="card-body">
            <div class="row g-3">
                <div class="col-md-3">
                    <label class="form-label">{{ 'stock.movements.product' | translate }}</label>
                    <select class="form-select" [(ngModel)]="filters.productId" (change)="onFilterChange()">
                        <option [ngValue]="undefined">{{ 'common.all' | translate }}</option>
                        <option *ngFor="let p of products" [value]="p.id">{{ p.name }}</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ 'stock.movements.warehouse' | translate }}</label>
                    <select class="form-select" [(ngModel)]="filters.warehouseId" (change)="onFilterChange()">
                        <option [ngValue]="undefined">{{ 'common.all' | translate }}</option>
                        <option *ngFor="let w of warehouses" [value]="w.id">{{ w.name }}</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label">{{ 'stock.movements.type' | translate }}</label>
                    <select class="form-select" [(ngModel)]="filters.type" (change)="onFilterChange()">
                        <option [ngValue]="undefined">{{ 'common.all' | translate }}</option>
                        <option value="ENTRY">Entr√©e</option>
                        <option value="EXIT">Sortie</option>
                        <option value="TRANSFER">Transfert</option>
                        <option value="ADJUSTMENT">Ajustement</option>
                    </select>
                </div>
                <!-- TODO: Date Range Picker -->
            </div>
        </div>
    </div>

    <!-- Data Table -->
    <div class="card" *ngIf="viewMode === 'list'">
        <div class="card-body p-0">
            <app-data-table [columns]="columns" [data]="movements" [loading]="loading" [config]="tableConfig">

                <ng-template #colTemplate let-row="row" let-col="col">
                    <ng-container [ngSwitch]="col.key">
                        <span *ngSwitchCase="'type'" [class]="getTypeClass(row.type)">
                            {{ getTypeLabel(row.type) }}
                        </span>
                    </ng-container>
                </ng-template>

            </app-data-table>
        </div>
    </div>

    <!-- Calendar View -->
    <div class="card" *ngIf="viewMode === 'calendar'">
        <div class="card-body">
            <app-calendar [events]="calendarEvents" [config]="calendarConfig" (eventClicked)="onEventClick($event)">
            </app-calendar>
        </div>
    </div>


    <!-- Create Modal -->
    <app-modal [isOpen]="showModal" [config]="modalConfig" (closed)="onFormCancel()">
        <app-form-builder *ngIf="showModal" [config]="formConfig" (submit)="onFormSubmit($event)"
            (cancel)="onFormCancel()">
        </app-form-builder>
    </app-modal>
</div>